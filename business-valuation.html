<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Business Valuation Questionnaire — SME Association of Australia</title>
<style>
/* ===== VARIABLES ===== */
:root {
  --primary: #1a3a5c;
  --primary-light: #2a5298;
  --accent: #e8a020;
  --accent-dark: #c47d0e;
  --success: #28a745;
  --warning: #ffc107;
  --danger: #dc3545;
  --info: #17a2b8;
  --bg: #f4f6f9;
  --card-bg: #ffffff;
  --border: #dee2e6;
  --text: #212529;
  --text-muted: #6c757d;
  --radius: 10px;
  --shadow: 0 2px 12px rgba(0,0,0,0.08);
  --shadow-lg: 0 8px 32px rgba(0,0,0,0.14);
  --transition: 0.3s ease;
}

/* ===== RESET & BASE ===== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  font-size: 15px;
}

/* ===== KEYFRAMES ===== */
@keyframes fadeSlideIn {
  from { opacity: 0; transform: translateY(18px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes fadeIn {
  from { opacity: 0; }
  to   { opacity: 1; }
}
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50%       { opacity: 0.6; }
}
.fade-slide-in {
  animation: fadeSlideIn 0.38s cubic-bezier(0.23, 1, 0.32, 1) both;
}

/* ===== HEADER ===== */
header {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
  color: #fff;
  padding: 0;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
.header-inner {
  max-width: 1100px;
  margin: 0 auto;
  padding: 14px 20px;
  display: flex;
  align-items: center;
  gap: 16px;
}
.header-logo {
  display: flex;
  align-items: center;
  flex-shrink: 0;
}
.header-logo svg {
  height: 48px;
  width: auto;
}
.header-text h1 {
  font-size: 17px;
  font-weight: 700;
  line-height: 1.2;
}
.header-text p {
  font-size: 12px;
  opacity: 0.8;
  margin-top: 1px;
}
.header-actions {
  margin-left: auto;
  display: flex;
  gap: 10px;
  align-items: center;
}
.share-btn {
  background: rgba(255,255,255,0.15);
  border: 1px solid rgba(255,255,255,0.3);
  color: #fff;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 12px;
  cursor: pointer;
  transition: background var(--transition);
  display: none;
}
.share-btn:hover { background: rgba(255,255,255,0.28); }
.share-btn.visible { display: inline-flex; align-items: center; gap: 6px; }

/* ===== AUTOSAVE BAR ===== */
#autosave-bar {
  background: #e8f5e9;
  border-bottom: 1px solid #c8e6c9;
  padding: 6px 20px;
  font-size: 12px;
  color: #2e7d32;
  text-align: center;
  display: none;
  animation: fadeIn 0.3s ease;
}
#autosave-bar.show { display: block; }

/* ===== PROGRESS BAR ===== */
#progress-wrap {
  background: var(--primary);
  border-bottom: 3px solid var(--accent);
  padding: 10px 0 0;
  display: none;
  overflow-x: auto;
}
#progress-wrap.show { display: block; }
.progress-pills {
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 20px 10px;
  display: flex;
  gap: 6px;
  flex-wrap: nowrap;
}
.pill {
  background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.2);
  color: rgba(255,255,255,0.7);
  padding: 5px 10px;
  border-radius: 20px;
  font-size: 11px;
  white-space: nowrap;
  cursor: pointer;
  transition: all var(--transition);
  display: flex;
  align-items: center;
  gap: 5px;
}
.pill:hover { background: rgba(255,255,255,0.22); color: #fff; }
.pill.active {
  background: var(--accent);
  border-color: var(--accent);
  color: #fff;
  font-weight: 600;
}
.pill.done {
  background: rgba(40,167,69,0.3);
  border-color: rgba(40,167,69,0.5);
  color: #a8e6bb;
}
.pill-pct {
  background: rgba(0,0,0,0.2);
  border-radius: 10px;
  padding: 1px 5px;
  font-size: 10px;
}
.pill.active .pill-pct { background: rgba(0,0,0,0.25); }

/* ===== MAIN WRAP ===== */
#main-wrap {
  max-width: 1100px;
  margin: 0 auto;
  padding: 28px 20px 60px;
}

/* ===== SECTION DISPLAY ===== */
.section { display: none; }
.section.active { display: block; }

/* ===== WELCOME ===== */
#welcome {
  max-width: 720px;
  margin: 0 auto;
  text-align: center;
  padding: 48px 20px;
}
.welcome-badge {
  display: inline-block;
  background: var(--accent);
  color: #fff;
  padding: 4px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  margin-bottom: 20px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
#welcome h2 {
  font-size: 32px;
  font-weight: 800;
  color: var(--primary);
  margin-bottom: 16px;
  line-height: 1.25;
}
#welcome p {
  color: var(--text-muted);
  font-size: 16px;
  margin-bottom: 12px;
  max-width: 560px;
  margin-left: auto;
  margin-right: auto;
}
.welcome-features {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin: 32px 0;
  text-align: left;
}
.welcome-feature {
  background: #fff;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 18px;
  box-shadow: var(--shadow);
}
.welcome-feature-icon {
  font-size: 24px;
  margin-bottom: 8px;
}
.welcome-feature h4 { font-size: 14px; color: var(--primary); margin-bottom: 4px; }
.welcome-feature p { font-size: 12px; color: var(--text-muted); margin: 0; }
.btn-start {
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
  color: #fff;
  border: none;
  padding: 16px 48px;
  border-radius: 50px;
  font-size: 17px;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 4px 20px rgba(232,160,32,0.4);
  transition: all var(--transition);
  margin-top: 8px;
}
.btn-start:hover { transform: translateY(-2px); box-shadow: 0 6px 28px rgba(232,160,32,0.5); }
#resume-hint {
  background: #fff3cd;
  border: 1px solid #ffc107;
  border-radius: var(--radius);
  padding: 14px 20px;
  margin-top: 20px;
  font-size: 14px;
  display: none;
}
#resume-hint.show { display: block; animation: fadeIn 0.4s ease; }
#resume-hint a { color: var(--primary); font-weight: 600; cursor: pointer; text-decoration: underline; }

/* ===== SECTION HEADING ===== */
.section-header {
  margin-bottom: 24px;
}
.section-badge {
  display: inline-block;
  background: var(--primary);
  color: #fff;
  padding: 3px 12px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
}
.section-header h2 {
  font-size: 24px;
  font-weight: 800;
  color: var(--primary);
  margin-bottom: 6px;
}
.section-header p {
  color: var(--text-muted);
  font-size: 14px;
}

/* ===== ERROR BANNER ===== */
.error-banner {
  background: #fff5f5;
  border: 1px solid #f5c6cb;
  border-left: 4px solid var(--danger);
  border-radius: var(--radius);
  padding: 12px 16px;
  margin-bottom: 18px;
  display: none;
  animation: fadeSlideIn 0.3s ease;
}
.error-banner.show { display: block; }
.error-banner strong { color: var(--danger); font-size: 14px; }
.error-banner ul { margin: 6px 0 0 18px; font-size: 13px; color: #721c24; }
.error-banner ul li { margin-bottom: 2px; }

/* ===== CARDS ===== */
.card {
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  margin-bottom: 18px;
  box-shadow: var(--shadow);
  transition: border-color var(--transition);
}
.card.has-error {
  border-color: var(--danger);
  box-shadow: 0 0 0 3px rgba(220,53,69,0.1);
}
.card h3 {
  font-size: 16px;
  font-weight: 700;
  color: var(--primary);
  margin-bottom: 16px;
  padding-bottom: 10px;
  border-bottom: 2px solid var(--bg);
  display: flex;
  align-items: center;
  gap: 8px;
}
.card-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}
.card-grid-3 {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
}
.field-group { margin-bottom: 14px; }
.field-group:last-child { margin-bottom: 0; }
label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: var(--primary);
  margin-bottom: 5px;
}
.field-error {
  color: var(--danger);
  font-size: 12px;
  margin-top: 4px;
  display: none;
}
.field-error.show { display: block; }

/* ===== INPUTS ===== */
input[type="text"],
input[type="email"],
input[type="number"],
input[type="tel"],
select,
textarea {
  width: 100%;
  padding: 9px 12px;
  border: 1.5px solid var(--border);
  border-radius: 7px;
  font-size: 14px;
  font-family: inherit;
  background: #fff;
  color: var(--text);
  transition: border-color var(--transition), box-shadow var(--transition);
  appearance: none;
}
input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--primary-light);
  box-shadow: 0 0 0 3px rgba(42,82,152,0.1);
}
input.error, select.error, textarea.error {
  border-color: var(--danger);
  box-shadow: 0 0 0 3px rgba(220,53,69,0.1);
}
select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%236c757d' d='M1 1l5 5 5-5'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 34px; }
textarea { resize: vertical; min-height: 80px; }
input[type="number"] { -moz-appearance: textfield; }
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; }

/* ===== TOOLTIPS ===== */
.tt {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 17px;
  height: 17px;
  background: var(--primary-light);
  color: #fff;
  border-radius: 50%;
  font-size: 10px;
  font-weight: 700;
  cursor: help;
  position: relative;
  vertical-align: middle;
  margin-left: 5px;
  flex-shrink: 0;
}
.tt::after {
  content: attr(data-tip);
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  background: #1a1a2e;
  color: #fff;
  padding: 8px 12px;
  border-radius: 7px;
  font-size: 12px;
  font-weight: 400;
  white-space: normal;
  width: 240px;
  line-height: 1.5;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
  z-index: 200;
  box-shadow: var(--shadow-lg);
}
.tt:hover::after { opacity: 1; }

/* ===== YOY DISPLAY ===== */
.yoy-display {
  background: #f0f4ff;
  border: 1px solid #c5d3f0;
  border-radius: 8px;
  padding: 12px 16px;
  margin-top: 10px;
  display: none;
}
.yoy-display.show { display: flex; gap: 24px; flex-wrap: wrap; }
.yoy-item { font-size: 13px; }
.yoy-item span { font-weight: 700; }
.yoy-pos { color: var(--success); }
.yoy-neg { color: var(--danger); }
.yoy-neu { color: var(--text-muted); }

/* ===== RADIO / CHECKBOX ===== */
.q-card {
  background: #fff;
  border: 1.5px solid var(--border);
  border-radius: var(--radius);
  padding: 18px 20px;
  margin-bottom: 14px;
  transition: border-color var(--transition);
}
.q-card.has-error {
  border-color: var(--danger);
  box-shadow: 0 0 0 3px rgba(220,53,69,0.1);
}
.q-card p.q-text {
  font-size: 14px;
  font-weight: 600;
  color: var(--primary);
  margin-bottom: 12px;
  display: flex;
  align-items: flex-start;
  gap: 6px;
}
.q-num {
  background: var(--primary);
  color: #fff;
  border-radius: 12px;
  padding: 1px 8px;
  font-size: 11px;
  font-weight: 700;
  white-space: nowrap;
  flex-shrink: 0;
  margin-top: 2px;
}
.radio-group, .check-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.radio-opt, .check-opt {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 9px 14px;
  border: 1.5px solid var(--border);
  border-radius: 8px;
  cursor: pointer;
  transition: all var(--transition);
  font-size: 13px;
  line-height: 1.4;
}
.radio-opt:hover, .check-opt:hover {
  border-color: var(--primary-light);
  background: #f0f4ff;
}
.radio-opt.selected {
  border-color: var(--primary-light);
  background: #e8efff;
  font-weight: 600;
  color: var(--primary);
}
.check-opt.selected {
  border-color: var(--success);
  background: #e8f5e9;
}
.radio-dot, .check-box {
  width: 18px;
  height: 18px;
  border: 2px solid var(--border);
  border-radius: 50%;
  flex-shrink: 0;
  margin-top: 1px;
  position: relative;
  transition: all var(--transition);
}
.check-box { border-radius: 4px; }
.radio-opt.selected .radio-dot {
  border-color: var(--primary-light);
  background: var(--primary-light);
}
.radio-opt.selected .radio-dot::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 7px;
  height: 7px;
  background: #fff;
  border-radius: 50%;
}
.check-opt.selected .check-box {
  border-color: var(--success);
  background: var(--success);
}
.check-opt.selected .check-box::after {
  content: '✓';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: #fff;
  font-size: 11px;
  font-weight: 700;
}
/* Hidden actual inputs */
input[type="radio"], input[type="checkbox"] { display: none; }

/* ===== VALUATION CALCULATOR ===== */
.valuation-box {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
  color: #fff;
  border-radius: 14px;
  padding: 24px;
  margin-bottom: 20px;
  box-shadow: var(--shadow-lg);
}
.sticky-calc {
  position: sticky;
  top: 120px;
  z-index: 50;
}
.valuation-box h3 {
  font-size: 15px;
  font-weight: 700;
  color: #fff;
  margin-bottom: 16px;
  opacity: 0.9;
  border-bottom: 1px solid rgba(255,255,255,0.2);
  padding-bottom: 10px;
}
.calc-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  font-size: 13px;
}
.calc-row:last-of-type { border-bottom: none; }
.calc-label { opacity: 0.8; }
.calc-value { font-weight: 700; font-size: 15px; }
.calc-total {
  background: rgba(255,255,255,0.15);
  border-radius: 8px;
  padding: 12px 16px;
  margin-top: 14px;
  text-align: center;
}
.calc-total-label { font-size: 12px; opacity: 0.8; margin-bottom: 4px; }
.calc-total-value { font-size: 26px; font-weight: 800; color: var(--accent); }
.calc-range { font-size: 11px; opacity: 0.7; margin-top: 4px; }
.quality-bar-wrap { margin-top: 14px; }
.quality-bar-label {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  opacity: 0.8;
  margin-bottom: 6px;
}
.quality-bar-track {
  height: 8px;
  background: rgba(255,255,255,0.2);
  border-radius: 4px;
  overflow: hidden;
}
.quality-bar-fill {
  height: 100%;
  border-radius: 4px;
  background: linear-gradient(90deg, #ef5350, #ffc107, #66bb6a);
  transition: width 0.5s ease;
  width: 0%;
}

/* ===== NAV BUTTONS ===== */
.nav-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 28px;
  gap: 12px;
}
.btn {
  padding: 11px 28px;
  border-radius: 8px;
  border: none;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition);
  display: inline-flex;
  align-items: center;
  gap: 8px;
}
.btn-primary {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
  color: #fff;
  box-shadow: 0 3px 12px rgba(26,58,92,0.3);
}
.btn-primary:hover { transform: translateY(-1px); box-shadow: 0 5px 18px rgba(26,58,92,0.4); }
.btn-secondary {
  background: #fff;
  color: var(--primary);
  border: 1.5px solid var(--border);
}
.btn-secondary:hover { border-color: var(--primary); background: #f0f4ff; }
.btn-success {
  background: linear-gradient(135deg, var(--success) 0%, #1e7e34 100%);
  color: #fff;
  box-shadow: 0 3px 12px rgba(40,167,69,0.3);
}
.btn-success:hover { transform: translateY(-1px); }

/* ===== LAYOUT: SECTION WITH SIDEBAR ===== */
.section-with-sidebar {
  display: grid;
  grid-template-columns: 1fr 320px;
  gap: 24px;
  align-items: start;
}
.section-main { min-width: 0; }

/* ===== RESULTS ===== */
#results { display: none; }
#results.active { display: block; }
.results-hero {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
  color: #fff;
  border-radius: 16px;
  padding: 36px;
  margin-bottom: 28px;
  text-align: center;
  box-shadow: var(--shadow-lg);
}
.results-hero h2 { font-size: 22px; font-weight: 700; opacity: 0.9; margin-bottom: 12px; }
.range-display { font-size: 44px; font-weight: 900; color: var(--accent); line-height: 1.1; }
.range-display small { font-size: 20px; opacity: 0.7; }
.results-meta { margin-top: 14px; font-size: 14px; opacity: 0.75; }
.quality-hero {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;
  margin-top: 20px;
  background: rgba(255,255,255,0.1);
  border-radius: 10px;
  padding: 14px 24px;
}
.quality-hero-label { font-size: 13px; opacity: 0.8; }
.quality-hero-score {
  font-size: 28px;
  font-weight: 800;
}
.quality-hero-bar {
  flex: 1;
  max-width: 200px;
  height: 10px;
  background: rgba(255,255,255,0.2);
  border-radius: 5px;
  overflow: hidden;
}
.quality-hero-bar-fill {
  height: 100%;
  border-radius: 5px;
  background: linear-gradient(90deg, #ef5350, #ffc107, #66bb6a);
  transition: width 0.8s ease;
}
.results-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 20px;
}
.results-card {
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--shadow);
}
.results-card h3 {
  font-size: 15px;
  font-weight: 700;
  color: var(--primary);
  margin-bottom: 14px;
  padding-bottom: 10px;
  border-bottom: 2px solid var(--bg);
}
.results-card-full {
  grid-column: 1 / -1;
}
.fin-row {
  display: flex;
  justify-content: space-between;
  padding: 7px 0;
  font-size: 13px;
  border-bottom: 1px solid #f0f0f0;
}
.fin-row:last-child { border-bottom: none; }
.fin-row strong { color: var(--primary); }
.fin-yoy { font-size: 11px; padding: 1px 6px; border-radius: 10px; font-weight: 600; }
.fin-yoy.pos { background: #e8f5e9; color: var(--success); }
.fin-yoy.neg { background: #ffebee; color: var(--danger); }
.score-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 0;
  border-bottom: 1px solid #f0f0f0;
  font-size: 13px;
}
.score-row:last-child { border-bottom: none; }
.score-cat { flex: 0 0 130px; color: var(--primary); font-weight: 600; font-size: 12px; }
.score-mini-bar { flex: 1; height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
.score-mini-fill { height: 100%; border-radius: 4px; transition: width 0.8s ease; }
.score-val { flex: 0 0 44px; text-align: right; font-weight: 700; font-size: 12px; }
.score-badge {
  flex: 0 0 70px;
  text-align: right;
  padding: 2px 7px;
  border-radius: 10px;
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
}
.score-excellent { background: #e8f5e9; color: #2e7d32; }
.score-good      { background: #e3f2fd; color: #1565c0; }
.score-fair      { background: #fff8e1; color: #f57f17; }
.score-poor      { background: #ffebee; color: #c62828; }

/* ===== OBSERVATIONS ===== */
.obs-list { display: flex; flex-direction: column; gap: 10px; }
.obs-item {
  padding: 12px 16px;
  border-radius: 8px;
  font-size: 13px;
  display: flex;
  align-items: flex-start;
  gap: 10px;
  line-height: 1.5;
}
.obs-icon { font-size: 16px; flex-shrink: 0; margin-top: 1px; }
.obs-item.positive { background: #e8f5e9; border-left: 4px solid var(--success); color: #1b5e20; }
.obs-item.warning  { background: #fff8e1; border-left: 4px solid var(--warning); color: #795548; }
.obs-item.info     { background: #e3f2fd; border-left: 4px solid var(--info); color: #0d47a1; }

/* ===== ADVISOR FORM ===== */
.advisor-capture {
  background: linear-gradient(135deg, #fff9f0 0%, #fff3e0 100%);
  border: 2px solid var(--accent);
  border-radius: 16px;
  padding: 32px;
  margin-bottom: 20px;
  text-align: center;
}
.advisor-capture h3 { font-size: 20px; font-weight: 800; color: var(--primary); margin-bottom: 8px; }
.advisor-capture p { color: var(--text-muted); font-size: 14px; margin-bottom: 24px; }
.advisor-form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
  text-align: left;
  max-width: 600px;
  margin: 0 auto 16px;
}
.advisor-capture .field-group label { color: var(--primary); }
.btn-advisor {
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
  color: #fff;
  border: none;
  padding: 13px 36px;
  border-radius: 50px;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 4px 16px rgba(232,160,32,0.4);
  transition: all var(--transition);
}
.btn-advisor:hover { transform: translateY(-2px); }
.advisor-success {
  background: #e8f5e9;
  border: 1px solid #c8e6c9;
  border-radius: 10px;
  padding: 20px;
  margin-top: 16px;
  display: none;
}
.advisor-success.show { display: block; }
.disclaimer {
  font-size: 11px;
  color: var(--text-muted);
  text-align: center;
  padding: 20px;
  line-height: 1.6;
  border-top: 1px solid var(--border);
  margin-top: 20px;
}

/* ===== CHECKBOX PRIVACY ===== */
.privacy-wrap {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  font-size: 13px;
  color: var(--text-muted);
  padding: 4px 0;
}
.privacy-wrap input[type="checkbox"] {
  display: inline-block;
  width: auto;
  margin-top: 2px;
}
.privacy-wrap a { color: var(--primary); }

/* ===== RESPONSIVE ===== */
@media (max-width: 900px) {
  .section-with-sidebar { grid-template-columns: 1fr; }
  .sticky-calc { position: static; }
  .results-grid { grid-template-columns: 1fr; }
  .welcome-features { grid-template-columns: 1fr; }
  .advisor-form-grid { grid-template-columns: 1fr; }
}
@media (max-width: 640px) {
  .card-grid, .card-grid-3 { grid-template-columns: 1fr; }
  #welcome h2 { font-size: 24px; }
  .range-display { font-size: 32px; }
  .results-hero { padding: 24px 16px; }
  .header-text h1 { font-size: 14px; }
  .progress-pills { gap: 4px; }
  .pill { font-size: 10px; padding: 4px 8px; }
  .location-card-inner { grid-template-columns: 1fr; }
}

/* ===== LOCATION & CURRENCY ===== */
.location-card {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
  border-radius: var(--radius);
  padding: 26px 28px;
  margin-bottom: 24px;
  color: #fff;
  box-shadow: var(--shadow-lg);
}
.location-card h3 {
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1.2px;
  color: rgba(255,255,255,0.65);
  margin-bottom: 16px;
}
.location-card-inner {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 14px;
  align-items: end;
}
.location-card label {
  display: block;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: rgba(255,255,255,0.65);
  margin-bottom: 6px;
}
.location-card select {
  width: 100%;
  padding: 10px 14px;
  border-radius: 6px;
  border: 1.5px solid rgba(255,255,255,0.2);
  background: rgba(255,255,255,0.10);
  color: #fff;
  font-size: 14px;
  outline: none;
  cursor: pointer;
  appearance: none;
  -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='rgba(255,255,255,0.6)' d='M6 8L0 0h12z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 32px;
  transition: border-color 0.2s, background-color 0.2s;
}
.location-card select:focus { border-color: var(--accent); background-color: rgba(255,255,255,0.15); }
.location-card select option { background: #1a3a5c; color: #fff; }
.currency-badge {
  display: flex;
  align-items: center;
  gap: 10px;
  background: rgba(255,255,255,0.10);
  border: 1.5px solid rgba(255,255,255,0.2);
  border-radius: 6px;
  padding: 10px 14px;
  min-height: 44px;
}
.currency-badge .cur-flag { font-size: 20px; }
.currency-badge .cur-details { display: flex; flex-direction: column; }
.currency-badge .cur-sym-big { font-size: 16px; font-weight: 700; color: var(--accent); line-height: 1; }
.currency-badge .cur-name-sm { font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 2px; }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="header-inner">
    <div class="header-logo">
      <!-- SME Association of Australia logo -->
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 220 72" aria-label="SME Association of Australia">
        <!-- Speech bubble body -->
        <ellipse cx="95" cy="29" rx="88" ry="27" fill="#1A6FC4"/>
        <!-- Speech bubble tail (bottom-left) -->
        <polygon points="18,50 4,68 52,50" fill="#1A6FC4"/>
        <!-- "sme" text -->
        <text x="95" y="39"
              font-family="'Arial Rounded MT Bold','Nunito','Arial',sans-serif"
              font-size="28" font-weight="900"
              fill="#ffffff" text-anchor="middle"
              letter-spacing="1">sme</text>
        <!-- "ASSOCIATION OF AUSTRALIA" -->
        <text x="113" y="63"
              font-family="'Helvetica Neue','Arial',sans-serif"
              font-size="7.8" font-weight="600"
              fill="rgba(255,255,255,0.82)" text-anchor="middle"
              letter-spacing="2.2">ASSOCIATION OF AUSTRALIA</text>
      </svg>
    </div>
    <div class="header-text">
      <h1>Business Valuation Questionnaire</h1>
      <p>Confidential Assessment</p>
    </div>
    <div class="header-actions">
      <button class="share-btn" id="share-btn" onclick="copyShareLink()">
        &#128279; Copy Resume Link
      </button>
    </div>
  </div>
</header>

<!-- AUTOSAVE BAR -->
<div id="autosave-bar">&#10003; Progress autosaved</div>

<!-- PROGRESS BAR -->
<div id="progress-wrap">
  <div class="progress-pills" id="progress-pills"></div>
</div>

<!-- MAIN WRAP -->
<div id="main-wrap">

  <!-- WELCOME -->
  <div id="welcome">
    <div class="welcome-badge">Free Assessment Tool</div>
    <h2>What Is Your Business Worth?</h2>
    <p>Complete our comprehensive 10-section assessment to receive an indicative valuation range, quality-of-business scorecard, and tailored insights.</p>
    <p style="font-size:13px;">Estimated time: <strong>15–20 minutes</strong> &nbsp;|&nbsp; <strong>13 sections</strong> &nbsp;|&nbsp; <strong>60+ questions</strong></p>
    <div class="welcome-features">
      <div class="welcome-feature">
        <div class="welcome-feature-icon">&#128200;</div>
        <h4>Indicative Value Range</h4>
        <p>Quality-adjusted EBITDA multiple based on your specific business profile.</p>
      </div>
      <div class="welcome-feature">
        <div class="welcome-feature-icon">&#9971;</div>
        <h4>Scorecard Across 10 Categories</h4>
        <p>Financials, Customers, Team, Growth, Risk, Innovation, Brand, Strategy, Exit Readiness, Capacity.</p>
      </div>
      <div class="welcome-feature">
        <div class="welcome-feature-icon">&#128274;</div>
        <h4>Fully Confidential</h4>
        <p>Your data stays in your browser. Share a resume link to continue later.</p>
      </div>
    </div>
    <button class="btn-start" onclick="startAssessment()">Begin Assessment &rarr;</button>
    <div id="resume-hint">
      &#128337; You have a saved session. <a onclick="resumeSaved(event)">Click here to resume</a> where you left off, or press Begin to start fresh.
    </div>
  </div>


  <!-- ==================== SECTION 1: INTAKE ==================== -->
  <div class="section" id="s1">
    <div class="section-header fade-slide-in">
      <div class="section-badge">Section 1 of 13</div>
      <h2>Business Intake</h2>
      <p>Tell us about your business and key contact details.</p>
    </div>
    <div id="err-s1" class="error-banner"></div>

    <!-- LOCATION & CURRENCY -->
    <div class="location-card fade-slide-in" id="card-s1-location">
      <h3>&#127760; Business Location &amp; Currency</h3>
      <div class="location-card-inner">
        <div>
          <label for="bizCountry">Country *</label>
          <select id="bizCountry" onchange="onCountryChange(); saveState();">
            <option value="">— Select country —</option>
            <option value="AU">&#127462;&#127482; Australia</option>
            <option value="US">&#127482;&#127480; United States</option>
            <option value="CA">&#127464;&#127462; Canada</option>
            <option value="GB">&#127468;&#127463; United Kingdom</option>
          </select>
        </div>
        <div>
          <label for="bizState">State / Province / County *</label>
          <select id="bizState" onchange="saveState();" disabled>
            <option value="">— Select country first —</option>
          </select>
        </div>
        <div>
          <label>Currency</label>
          <div class="currency-badge" id="currencyBadge">
            <span class="cur-flag" id="curFlag">&#127760;</span>
            <div class="cur-details">
              <span class="cur-sym-big" id="curSymBig">—</span>
              <span class="cur-name-sm" id="curNameSm">Select a country</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card fade-slide-in" id="card-s1-basic">
      <h3>&#127968; Business Details</h3>
      <div class="card-grid">
        <div class="field-group">
          <label for="legalName">Legal Business Name *</label>
          <input type="text" id="legalName" placeholder="e.g. Smith Holdings Pty Ltd" oninput="saveState()">
        </div>
        <div class="field-group">
          <label for="tradingName">Trading Name</label>
          <input type="text" id="tradingName" placeholder="e.g. Smith & Co" oninput="saveState()">
        </div>
        <div class="field-group">
          <label for="industry">Industry (ANZSIC) *</label>
          <select id="industry" onchange="autoMapSector(); saveState();">
            <option value="">— Select industry —</option>
            <option value="agri">A — Agriculture, Forestry &amp; Fishing</option>
            <option value="mining">B — Mining</option>
            <option value="manuf">C — Manufacturing</option>
            <option value="util">D — Electricity, Gas, Water &amp; Waste</option>
            <option value="const">E — Construction</option>
            <option value="trade">F — Wholesale Trade</option>
            <option value="retail">G — Retail Trade</option>
            <option value="accom">H — Accommodation &amp; Food Services</option>
            <option value="trans">I — Transport, Postal &amp; Warehousing</option>
            <option value="media">J — Information, Media &amp; Telecommunications</option>
            <option value="fin">K — Financial &amp; Insurance Services</option>
            <option value="prop">L — Rental, Hiring &amp; Real Estate</option>
            <option value="prof">M — Professional, Scientific &amp; Technical Services</option>
            <option value="admin">N — Administrative &amp; Support Services</option>
            <option value="edu">P — Education &amp; Training</option>
            <option value="health">Q — Health Care &amp; Social Assistance</option>
            <option value="arts">R — Arts &amp; Recreation Services</option>
            <option value="other">S — Other Services</option>
          </select>
        </div>
        <div class="field-group">
          <label for="headcount">Number of Employees *</label>
          <select id="headcount" onchange="saveState()">
            <option value="">— Select —</option>
            <option value="1">Just me (sole trader)</option>
            <option value="2-4">2 – 4 employees</option>
            <option value="5-19">5 – 19 employees</option>
            <option value="20-49">20 – 49 employees</option>
            <option value="50-99">50 – 99 employees</option>
            <option value="100+">100+ employees</option>
          </select>
        </div>
        <div class="field-group">
          <label for="yearFounded">Year Business Founded *</label>
          <input type="number" id="yearFounded" placeholder="e.g. 2010" min="1900" max="2026" oninput="saveState()">
        </div>
        <div class="field-group">
          <label for="ownerAge">Primary Owner Age Range</label>
          <select id="ownerAge" onchange="saveState()">
            <option value="">— Select —</option>
            <option value="under30">Under 30</option>
            <option value="30-39">30 – 39</option>
            <option value="40-49">40 – 49</option>
            <option value="50-59">50 – 59</option>
            <option value="60-69">60 – 69</option>
            <option value="70+">70+</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card fade-slide-in" id="card-s1-contact">
      <h3>&#128100; Contact Details</h3>
      <div class="card-grid">
        <div class="field-group">
          <label for="contactName">Contact Full Name *</label>
          <input type="text" id="contactName" placeholder="e.g. Jane Smith" oninput="saveState()">
        </div>
        <div class="field-group">
          <label for="contactTitle">Title / Role</label>
          <input type="text" id="contactTitle" placeholder="e.g. Managing Director" oninput="saveState()">
        </div>
        <div class="field-group">
          <label for="contactEmail">Email Address *</label>
          <input type="email" id="contactEmail" placeholder="jane@company.com.au" oninput="saveState()">
        </div>
        <div class="field-group">
          <label for="contactMobile">Mobile Number</label>
          <input type="tel" id="contactMobile" placeholder="04xx xxx xxx" oninput="saveState()">
        </div>
        <div class="field-group">
          <label for="advisorName">Referring Advisor Name</label>
          <input type="text" id="advisorName" placeholder="e.g. John Brown" oninput="saveState()">
        </div>
        <div class="field-group">
          <label for="advisorEmail">Referring Advisor Email</label>
          <input type="email" id="advisorEmail" placeholder="john@firm.com.au" oninput="saveState()">
        </div>
      </div>
      <div class="field-group" style="margin-top:14px;">
        <div class="privacy-wrap">
          <input type="checkbox" id="privacyCheck" onchange="saveState()">
          <label for="privacyCheck" style="font-weight:400;cursor:pointer;">I consent to SME Association of Australia handling this information in accordance with their <a href="#" target="_blank">Privacy Policy</a>. *</label>
        </div>
      </div>
    </div>

    <div class="nav-row">
      <div></div>
      <button class="btn btn-primary" onclick="validateAndGo(2)">Next: Financials &rarr;</button>
    </div>
  </div>


  <!-- ==================== SECTION 2: FINANCIALS ==================== -->
  <div class="section" id="s2">
    <div class="section-header fade-slide-in">
      <div class="section-badge">Section 2 of 13</div>
      <h2>Financial Performance</h2>
      <p>Provide your key financial metrics for the most recent and prior financial year.</p>
    </div>
    <div id="err-s2" class="error-banner"></div>

    <div class="card fade-slide-in" id="card-s2-rev">
      <h3>&#128176; Revenue &amp; EBITDA</h3>
      <div class="card-grid">
        <div class="field-group">
          <label for="B1">Revenue — Current Year (<span class="cur-sym">A$</span>) *
            <span class="tt" data-tip="Total gross revenue for your most recently completed financial year (before expenses).">?</span>
          </label>
          <input type="number" id="B1" placeholder="e.g. 2500000" min="0" oninput="updateCalc(); updateYoY(); saveState()">
        </div>
        <div class="field-group">
          <label for="B1_prev">Revenue — Prior Year (<span class="cur-sym">A$</span>)</label>
          <input type="number" id="B1_prev" placeholder="e.g. 2200000" min="0" oninput="updateYoY(); saveState()">
        </div>
        <div class="field-group">
          <label for="B2">EBITDA — Current Year (<span class="cur-sym">A$</span>) *
            <span class="tt" data-tip="Earnings Before Interest, Tax, Depreciation &amp; Amortisation. Add back owner's salary above market rate, one-off items, and non-cash charges.">?</span>
          </label>
          <input type="number" id="B2" placeholder="e.g. 500000" oninput="updateCalc(); updateYoY(); saveState()">
        </div>
        <div class="field-group">
          <label for="B2_prev">EBITDA — Prior Year (<span class="cur-sym">A$</span>)</label>
          <input type="number" id="B2_prev" placeholder="e.g. 420000" oninput="updateYoY(); saveState()">
        </div>
      </div>
      <div id="yoy-display" class="yoy-display"></div>
    </div>

    <div class="q-card fade-slide-in" id="card-B3">
      <p class="q-text"><span class="q-num">B3</span> What is the trend of your revenue over the last 3 years?</p>
      <div class="radio-group" id="rg-B3">
        <label class="radio-opt" onclick="selectRadio('B3','growing_fast',this)"><span class="radio-dot"></span>Growing strongly (&gt;15% per year)</label>
        <label class="radio-opt" onclick="selectRadio('B3','growing',this)"><span class="radio-dot"></span>Growing steadily (5–15% per year)</label>
        <label class="radio-opt" onclick="selectRadio('B3','flat',this)"><span class="radio-dot"></span>Broadly flat (±5%)</label>
        <label class="radio-opt" onclick="selectRadio('B3','declining',this)"><span class="radio-dot"></span>Declining</label>
      </div>
      <input type="hidden" id="B3" name="B3">
    </div>

    <div class="q-card fade-slide-in" id="card-B4">
      <p class="q-text"><span class="q-num">B4</span> What is your approximate EBITDA margin (EBITDA ÷ Revenue)?</p>
      <div class="radio-group" id="rg-B4">
        <label class="radio-opt" onclick="selectRadio('B4','above25',this)"><span class="radio-dot"></span>Above 25%</label>
        <label class="radio-opt" onclick="selectRadio('B4','15to25',this)"><span class="radio-dot"></span>15% – 25%</label>
        <label class="radio-opt" onclick="selectRadio('B4','5to15',this)"><span class="radio-dot"></span>5% – 15%</label>
        <label class="radio-opt" onclick="selectRadio('B4','below5',this)"><span class="radio-dot"></span>Below 5%</label>
      </div>
      <input type="hidden" id="B4" name="B4">
    </div>

    <div class="q-card fade-slide-in" id="card-B5">
      <p class="q-text"><span class="q-num">B5</span> How predictable / recurring is your revenue?</p>
      <div class="radio-group" id="rg-B5">
        <label class="radio-opt" onclick="selectRadio('B5','highly_recurring',this)"><span class="radio-dot"></span>Highly recurring — subscriptions or long-term contracts (&gt;70%)</label>
        <label class="radio-opt" onclick="selectRadio('B5','mostly_recurring',this)"><span class="radio-dot"></span>Mostly recurring — repeat customers but informal (40–70%)</label>
        <label class="radio-opt" onclick="selectRadio('B5','partly_recurring',this)"><span class="radio-dot"></span>Partly recurring — some regulars, some new (20–40%)</label>
        <label class="radio-opt" onclick="selectRadio('B5','transactional',this)"><span class="radio-dot"></span>Largely transactional — new customers each time</label>
      </div>
      <input type="hidden" id="B5" name="B5">
    </div>

    <div class="q-card fade-slide-in" id="card-B6">
      <p class="q-text"><span class="q-num">B6</span> How is revenue distributed across customers?</p>
      <div class="radio-group" id="rg-B6">
        <label class="radio-opt" onclick="selectRadio('B6','well_spread',this)"><span class="radio-dot"></span>Well spread — no single customer &gt;10%</label>
        <label class="radio-opt" onclick="selectRadio('B6','moderate',this)"><span class="radio-dot"></span>Moderate — largest customer 10–25%</label>
        <label class="radio-opt" onclick="selectRadio('B6','concentrated',this)"><span class="radio-dot"></span>Concentrated — largest customer 25–50%</label>
        <label class="radio-opt" onclick="selectRadio('B6','highly_concentrated',this)"><span class="radio-dot"></span>Highly concentrated — one customer &gt;50%</label>
      </div>
      <input type="hidden" id="B6" name="B6">
    </div>

    <div class="q-card fade-slide-in" id="card-B7">
      <p class="q-text"><span class="q-num">B7</span> What are your average debtor days (days sales outstanding)?
        <span class="tt" data-tip="Debtor Days = (Trade Debtors ÷ Revenue) × 365. Lower is generally better; industry averages vary from 14 days (retail) to 60+ days (B2B professional services).">?</span>
      </p>
      <div class="radio-group" id="rg-B7">
        <label class="radio-opt" onclick="selectRadio('B7','under15',this)"><span class="radio-dot"></span>Under 15 days</label>
        <label class="radio-opt" onclick="selectRadio('B7','15to30',this)"><span class="radio-dot"></span>15 – 30 days</label>
        <label class="radio-opt" onclick="selectRadio('B7','30to60',this)"><span class="radio-dot"></span>30 – 60 days</label>
        <label class="radio-opt" onclick="selectRadio('B7','over60',this)"><span class="radio-dot"></span>Over 60 days</label>
      </div>
      <input type="hidden" id="B7" name="B7">
    </div>

    <div class="q-card fade-slide-in" id="card-B8">
      <p class="q-text"><span class="q-num">B8</span> How would you describe your working capital position?
        <span class="tt" data-tip="Working Capital = Current Assets minus Current Liabilities. A positive and stable working capital means the business can meet its short-term obligations comfortably.">?</span>
      </p>
      <div class="radio-group" id="rg-B8">
        <label class="radio-opt" onclick="selectRadio('B8','strong_positive',this)"><span class="radio-dot"></span>Strong positive — easily meets obligations, cash buffer &gt;3 months</label>
        <label class="radio-opt" onclick="selectRadio('B8','adequate',this)"><span class="radio-dot"></span>Adequate — positive but managed closely</label>
        <label class="radio-opt" onclick="selectRadio('B8','tight',this)"><span class="radio-dot"></span>Tight — occasionally requires overdraft</label>
        <label class="radio-opt" onclick="selectRadio('B8','negative',this)"><span class="radio-dot"></span>Negative — regularly relies on debt or owner funding</label>
      </div>
      <input type="hidden" id="B8" name="B8">
    </div>

    <div class="q-card fade-slide-in" id="card-B9">
      <p class="q-text"><span class="q-num">B9</span> How reliable are your financial records and management accounts?</p>
      <div class="radio-group" id="rg-B9">
        <label class="radio-opt" onclick="selectRadio('B9','audited',this)"><span class="radio-dot"></span>Audited financial statements</label>
        <label class="radio-opt" onclick="selectRadio('B9','reviewed',this)"><span class="radio-dot"></span>Reviewed / compiled by external accountant</label>
        <label class="radio-opt" onclick="selectRadio('B9','internal',this)"><span class="radio-dot"></span>Internal management accounts (monthly)</label>
        <label class="radio-opt" onclick="selectRadio('B9','basic',this)"><span class="radio-dot"></span>Basic records / BAS-only</label>
      </div>
      <input type="hidden" id="B9" name="B9">
    </div>

    <div class="q-card fade-slide-in" id="card-B10">
      <p class="q-text"><span class="q-num">B10</span> Does the business have any significant debt or contingent liabilities?</p>
      <div class="radio-group" id="rg-B10">
        <label class="radio-opt" onclick="selectRadio('B10','none',this)"><span class="radio-dot"></span>No significant debt</label>
        <label class="radio-opt" onclick="selectRadio('B10','manageable',this)"><span class="radio-dot"></span>Some debt — comfortably serviceable (gearing &lt;2x EBITDA)</label>
        <label class="radio-opt" onclick="selectRadio('B10','moderate',this)"><span class="radio-dot"></span>Moderate debt (2–3x EBITDA)</label>
        <label class="radio-opt" onclick="selectRadio('B10','high',this)"><span class="radio-dot"></span>High debt or contingent liabilities (&gt;3x EBITDA)</label>
      </div>
      <input type="hidden" id="B10" name="B10">
    </div>

    <div class="q-card fade-slide-in" id="card-B11">
      <p class="q-text"><span class="q-num">B11</span> How strong is your gross profit margin vs. industry peers?</p>
      <div class="radio-group" id="rg-B11">
        <label class="radio-opt" onclick="selectRadio('B11','top_quartile',this)"><span class="radio-dot"></span>Top quartile — well above industry average</label>
        <label class="radio-opt" onclick="selectRadio('B11','above_avg',this)"><span class="radio-dot"></span>Above average</label>
        <label class="radio-opt" onclick="selectRadio('B11','average',this)"><span class="radio-dot"></span>About average</label>
        <label class="radio-opt" onclick="selectRadio('B11','below_avg',this)"><span class="radio-dot"></span>Below average</label>
      </div>
      <input type="hidden" id="B11" name="B11">
    </div>

    <div class="q-card fade-slide-in" id="card-BGPM">
      <p class="q-text"><span class="q-num">B12</span> Quality of earnings — how representative is reported EBITDA of underlying business performance?
        <span class="tt" data-tip="Quality of Earnings (QoE) assesses whether reported profits are sustainable and cash-backed. High QoE means profits are recurring, not reliant on one-offs, related-party transactions or aggressive accounting.">?</span>
      </p>
      <div class="radio-group" id="rg-BGPM">
        <label class="radio-opt" onclick="selectRadio('BGPM','high',this)"><span class="radio-dot"></span>High — recurring, cash-backed, no owner adjustments required</label>
        <label class="radio-opt" onclick="selectRadio('BGPM','good',this)"><span class="radio-dot"></span>Good — minor normalisation adjustments needed</label>
        <label class="radio-opt" onclick="selectRadio('BGPM','moderate',this)"><span class="radio-dot"></span>Moderate — significant owner salary or one-off items to adjust</label>
        <label class="radio-opt" onclick="selectRadio('BGPM','low',this)"><span class="radio-dot"></span>Low — heavily adjusted or reliant on non-recurring items</label>
      </div>
      <input type="hidden" id="BGPM" name="BGPM">
    </div>

    <div class="nav-row">
      <button class="btn btn-secondary" onclick="goToSection(1)">&larr; Previous</button>
      <button class="btn btn-primary" onclick="validateAndGo(3)">Next: Deep Dive &rarr;</button>
    </div>
  </div>


  <!-- ==================== SECTION 3: DEEP DIVE ==================== -->
  <div class="section" id="s3">
    <div class="section-header fade-slide-in">
      <div class="section-badge">Section 3 of 13</div>
      <h2>Valuation Deep Dive</h2>
      <p>Detailed financial inputs for the live valuation calculator. The sector multiple is auto-mapped from your industry selection.</p>
    </div>
    <div id="err-s3" class="error-banner"></div>

    <div class="section-with-sidebar">
      <div class="section-main">

        <div class="card fade-slide-in" id="card-D1">
          <h3>&#127970; Sector &amp; Valuation Inputs</h3>
          <div class="field-group">
            <label for="D1">Sector Multiple Benchmark *
              <span class="tt" data-tip="Auto-mapped from your ANZSIC industry selection. You may override if you have sector-specific knowledge.">?</span>
            </label>
            <select id="D1" onchange="updateCalc(); saveState()">
              <option value="">— Auto-mapped from industry —</option>
              <option value="agri">Agriculture / Farming (2.5 – 4.0x)</option>
              <option value="mining">Mining &amp; Resources (3.0 – 5.0x)</option>
              <option value="manuf">Manufacturing (3.5 – 5.5x)</option>
              <option value="util">Utilities &amp; Infrastructure (5.0 – 8.0x)</option>
              <option value="const">Construction (2.5 – 4.0x)</option>
              <option value="trade">Wholesale Trade (2.5 – 4.0x)</option>
              <option value="retail">Retail (2.0 – 4.0x)</option>
              <option value="accom">Accommodation &amp; Food (2.0 – 3.5x)</option>
              <option value="trans">Transport &amp; Logistics (3.0 – 5.0x)</option>
              <option value="media">Technology, Media &amp; Telco (4.0 – 8.0x)</option>
              <option value="fin">Financial Services (4.0 – 7.0x)</option>
              <option value="prop">Property &amp; Real Estate (3.0 – 5.0x)</option>
              <option value="prof">Professional Services (3.5 – 6.0x)</option>
              <option value="admin">Admin &amp; Support Services (3.0 – 5.0x)</option>
              <option value="edu">Education &amp; Training (3.5 – 6.0x)</option>
              <option value="health">Health &amp; Aged Care (4.0 – 7.0x)</option>
              <option value="arts">Arts &amp; Recreation (2.5 – 4.5x)</option>
              <option value="other">Other Services (2.5 – 4.0x)</option>
            </select>
          </div>
          <div class="card-grid" style="margin-top:14px;">
            <div class="field-group">
              <label for="D2a">Reported EBITDA (<span class="cur-sym">A$</span>)
                <span class="tt" data-tip="Earnings Before Interest, Tax, Depreciation and Amortisation. Use the same figure as B2 above.">?</span>
              </label>
              <input type="number" id="D2a" placeholder="Pulled from Section 2" oninput="updateCalc(); saveState()">
            </div>
            <div class="field-group">
              <label for="D2b">Normalised / Adjusted EBITDA (<span class="cur-sym">A$</span>)
                <span class="tt" data-tip="Normalised EBITDA adds back non-recurring costs, excess owner salary above market, one-off legal costs, and removes one-off income. This is the figure used in valuation.">?</span>
              </label>
              <input type="number" id="D2b" placeholder="e.g. after owner salary add-back" oninput="updateCalc(); saveState()">
            </div>
          </div>
        </div>

        <div class="q-card fade-slide-in" id="card-D3">
          <p class="q-text"><span class="q-num">D3</span> Which best describes the business model and revenue type?</p>
          <div class="radio-group" id="rg-D3">
            <label class="radio-opt" onclick="selectRadio('D3','saas_sub',this)"><span class="radio-dot"></span>SaaS / Subscription — recurring software or service revenue</label>
            <label class="radio-opt" onclick="selectRadio('D3','contract',this)"><span class="radio-dot"></span>Long-term contracts (&gt;12 months) with government or corporates</label>
            <label class="radio-opt" onclick="selectRadio('D3','repeat_b2b',this)"><span class="radio-dot"></span>Repeat B2B — informal but sticky customer relationships</label>
            <label class="radio-opt" onclick="selectRadio('D3','project',this)"><span class="radio-dot"></span>Project-based — wins contracts individually each time</label>
            <label class="radio-opt" onclick="selectRadio('D3','retail_consumer',this)"><span class="radio-dot"></span>Retail / Consumer — largely transactional</label>
          </div>
          <input type="hidden" id="D3" name="D3">
        </div>

        <div class="q-card fade-slide-in" id="card-D4">
          <p class="q-text"><span class="q-num">D4</span> How dependent is the business on the owner/founder?</p>
          <div class="radio-group" id="rg-D4">
            <label class="radio-opt" onclick="selectRadio('D4','fully_independent',this)"><span class="radio-dot"></span>Fully independent — runs profitably without owner</label>
            <label class="radio-opt" onclick="selectRadio('D4','largely_independent',this)"><span class="radio-dot"></span>Largely independent — owner strategic only, &lt;2 days/week</label>
            <label class="radio-opt" onclick="selectRadio('D4','partially_dependent',this)"><span class="radio-dot"></span>Partially dependent — owner in key relationships or decisions</label>
            <label class="radio-opt" onclick="selectRadio('D4','highly_dependent',this)"><span class="radio-dot"></span>Highly dependent — business would struggle without owner</label>
          </div>
          <input type="hidden" id="D4" name="D4">
        </div>

        <div class="q-card fade-slide-in" id="card-D5">
          <p class="q-text"><span class="q-num">D5</span> Are there documented systems, processes and IP protecting the business?</p>
          <div class="radio-group" id="rg-D5">
            <label class="radio-opt" onclick="selectRadio('D5','comprehensive',this)"><span class="radio-dot"></span>Comprehensive — documented SOPs, registered IP, proprietary systems</label>
            <label class="radio-opt" onclick="selectRadio('D5','good',this)"><span class="radio-dot"></span>Good — most key processes documented, some IP registered</label>
            <label class="radio-opt" onclick="selectRadio('D5','basic',this)"><span class="radio-dot"></span>Basic — some documentation, no formal IP</label>
            <label class="radio-opt" onclick="selectRadio('D5','minimal',this)"><span class="radio-dot"></span>Minimal — relies on tribal knowledge</label>
          </div>
          <input type="hidden" id="D5" name="D5">
        </div>

        <div class="q-card fade-slide-in" id="card-D6">
          <p class="q-text"><span class="q-num">D6</span> How strong are the growth prospects for the sector and business?</p>
          <div class="radio-group" id="rg-D6">
            <label class="radio-opt" onclick="selectRadio('D6','high_growth',this)"><span class="radio-dot"></span>High-growth sector — tailwinds, expanding market, strong pipeline</label>
            <label class="radio-opt" onclick="selectRadio('D6','steady_growth',this)"><span class="radio-dot"></span>Steady growth — stable market, consistent demand</label>
            <label class="radio-opt" onclick="selectRadio('D6','mature',this)"><span class="radio-dot"></span>Mature / stable — competitive but established</label>
            <label class="radio-opt" onclick="selectRadio('D6','declining',this)"><span class="radio-dot"></span>Declining or disrupted sector</label>
          </div>
          <input type="hidden" id="D6" name="D6">
        </div>

        <div class="nav-row">
          <button class="btn btn-secondary" onclick="goToSection(2)">&larr; Previous</button>
          <button class="btn btn-primary" onclick="validateAndGo(4)">Next: Growth &rarr;</button>
        </div>
      </div>

      <!-- STICKY CALCULATOR -->
      <div>
        <div class="valuation-box sticky-calc" id="valuation-box">
          <h3>&#128200; Live Valuation Estimate</h3>
          <div class="calc-row">
            <span class="calc-label">Normalised EBITDA</span>
            <span class="calc-value" id="calc-ebitda">—</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">Sector Range</span>
            <span class="calc-value" id="calc-range">—</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">Quality Score</span>
            <span class="calc-value" id="calc-quality">—</span>
          </div>
          <div class="calc-row">
            <span class="calc-label">Adj. Multiple</span>
            <span class="calc-value" id="calc-multiple">—</span>
          </div>
          <div class="calc-total">
            <div class="calc-total-label">Indicative Enterprise Value</div>
            <div class="calc-total-value" id="calc-total">—</div>
            <div class="calc-range" id="calc-range-display">Enter EBITDA &amp; select sector to calculate</div>
          </div>
          <div class="quality-bar-wrap">
            <div class="quality-bar-label">
              <span>Business Quality</span>
              <span id="calc-quality-pct">0%</span>
            </div>
            <div class="quality-bar-track">
              <div class="quality-bar-fill" id="quality-bar-fill"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- ==================== SECTION 4: GROWTH ==================== -->
  <div class="section" id="s4">
    <div class="section-header fade-slide-in">
      <div class="section-badge">Section 4 of 13</div>
      <h2>Growth &amp; Pipeline</h2>
      <p>Assess your business's growth trajectory and future revenue pipeline.</p>
    </div>
    <div id="err-s4" class="error-banner"></div>

    <div class="q-card fade-slide-in" id="card-G1">
      <p class="q-text"><span class="q-num">G1</span> How strong is your current new business pipeline?</p>
      <div class="radio-group" id="rg-G1">
        <label class="radio-opt" onclick="selectRadio('G1','strong',this)"><span class="radio-dot"></span>Strong — pipeline covers &gt;6 months of revenue targets</label>
        <label class="radio-opt" onclick="selectRadio('G1','good',this)"><span class="radio-dot"></span>Good — pipeline covers 3–6 months</label>
        <label class="radio-opt" onclick="selectRadio('G1','moderate',this)"><span class="radio-dot"></span>Moderate — pipeline covers 1–3 months</label>
        <label class="radio-opt" onclick="selectRadio('G1','weak',this)"><span class="radio-dot"></span>Weak — limited visibility beyond current month</label>
      </div>
      <input type="hidden" id="G1" name="G1">
    </div>

    <div class="q-card fade-slide-in" id="card-G2">
      <p class="q-text"><span class="q-num">G2</span> Does the business have documented and executed growth strategies?</p>
      <div class="radio-group" id="rg-G2">
        <label class="radio-opt" onclick="selectRadio('G2','active_multi',this)"><span class="radio-dot"></span>Yes — multiple active growth strategies (new markets, products, channels)</label>
        <label class="radio-opt" onclick="selectRadio('G2','active_one',this)"><span class="radio-dot"></span>Yes — one clear growth strategy being executed</label>
        <label class="radio-opt" onclick="selectRadio('G2','planned',this)"><span class="radio-dot"></span>Planned but not yet executing</label>
        <label class="radio-opt" onclick="selectRadio('G2','none',this)"><span class="radio-dot"></span>No formal growth strategy</label>
      </div>
      <input type="hidden" id="G2" name="G2">
    </div>

    <div class="q-card fade-slide-in" id="card-G3">
      <p class="q-text"><span class="q-num">G3</span> What is your Net Promoter Score or customer satisfaction level?</p>
      <div class="radio-group" id="rg-G3">
        <label class="radio-opt" onclick="selectRadio('G3','excellent',this)"><span class="radio-dot"></span>Excellent — NPS &gt;50 or formal high-satisfaction data</label>
        <label class="radio-opt" onclick="selectRadio('G3','good',this)"><span class="radio-dot"></span>Good — NPS 20–50 or positive anecdotal feedback</label>
        <label class="radio-opt" onclick="selectRadio('G3','average',this)"><span class="radio-dot"></span>Average — mixed feedback, no formal measurement</label>
        <label class="radio-opt" onclick="selectRadio('G3','poor',this)"><span class="radio-dot"></span>Poor — known service issues or complaints</label>
      </div>
      <input type="hidden" id="G3" name="G3">
    </div>

    <div class="q-card fade-slide-in" id="card-G4">
      <p class="q-text"><span class="q-num">G4</span> Is there an identified and sizeable addressable market opportunity?</p>
      <div class="radio-group" id="rg-G4">
        <label class="radio-opt" onclick="selectRadio('G4','large',this)"><span class="radio-dot"></span>Large TAM — significant untapped market domestically and/or internationally</label>
        <label class="radio-opt" onclick="selectRadio('G4','moderate',this)"><span class="radio-dot"></span>Moderate — reasonable growth headroom in current market</label>
        <label class="radio-opt" onclick="selectRadio('G4','limited',this)"><span class="radio-dot"></span>Limited — niche market, most growth already captured</label>
        <label class="radio-opt" onclick="selectRadio('G4','declining',this)"><span class="radio-dot"></span>Declining addressable market</label>
      </div>
      <input type="hidden" id="G4" name="G4">
    </div>

    <div class="q-card fade-slide-in" id="card-G5">
      <p class="q-text"><span class="q-num">G5</span> Does the business have a clear competitive advantage (moat)?</p>
      <div class="radio-group" id="rg-G5">
        <label class="radio-opt" onclick="selectRadio('G5','strong_moat',this)"><span class="radio-dot"></span>Strong moat — proprietary tech, exclusive contracts, switching costs, brand</label>
        <label class="radio-opt" onclick="selectRadio('G5','moderate_moat',this)"><span class="radio-dot"></span>Moderate moat — differentiated offering, loyal customers</label>
        <label class="radio-opt" onclick="selectRadio('G5','weak_moat',this)"><span class="radio-dot"></span>Weak moat — some differentiation but easy to replicate</label>
        <label class="radio-opt" onclick="selectRadio('G5','no_moat',this)"><span class="radio-dot"></span>No moat — commodity, price-competitive market</label>
      </div>
      <input type="hidden" id="G5" name="G5">
    </div>

    <div class="nav-row">
      <button class="btn btn-secondary" onclick="goToSection(3)">&larr; Previous</button>
      <button class="btn btn-primary" onclick="validateAndGo(5)">Next: Customers &rarr;</button>
    </div>
  </div>

  <!-- ==================== SECTION 5: CUSTOMERS ==================== -->
  <div class="section" id="s5">
    <div class="section-header fade-slide-in">
      <div class="section-badge">Section 5 of 13</div>
      <h2>Customer Base &amp; Relationships</h2>
      <p>Evaluate the quality, diversity and depth of your customer relationships.</p>
    </div>
    <div id="err-s5" class="error-banner"></div>

    <div class="q-card fade-slide-in" id="card-C1">
      <p class="q-text"><span class="q-num">C1</span> How long has your average key customer been with the business?</p>
      <div class="radio-group" id="rg-C1">
        <label class="radio-opt" onclick="selectRadio('C1','over5yr',this)"><span class="radio-dot"></span>Over 5 years — deeply embedded relationships</label>
        <label class="radio-opt" onclick="selectRadio('C1','2to5yr',this)"><span class="radio-dot"></span>2 – 5 years</label>
        <label class="radio-opt" onclick="selectRadio('C1','1to2yr',this)"><span class="radio-dot"></span>1 – 2 years</label>
        <label class="radio-opt" onclick="selectRadio('C1','under1yr',this)"><span class="radio-dot"></span>Less than 1 year on average</label>
      </div>
      <input type="hidden" id="C1" name="C1">
    </div>

    <div class="q-card fade-slide-in" id="card-C2">
      <p class="q-text"><span class="q-num">C2</span> How is your customer base structured (number of active customers)?</p>
      <div class="radio-group" id="rg-C2">
        <label class="radio-opt" onclick="selectRadio('C2','over500',this)"><span class="radio-dot"></span>500+ active customers — well diversified</label>
        <label class="radio-opt" onclick="selectRadio('C2','100to500',this)"><span class="radio-dot"></span>100 – 500 customers</label>
        <label class="radio-opt" onclick="selectRadio('C2','20to100',this)"><span class="radio-dot"></span>20 – 100 customers</label>
        <label class="radio-opt" onclick="selectRadio('C2','under20',this)"><span class="radio-dot"></span>Fewer than 20 customers</label>
      </div>
      <input type="hidden" id="C2" name="C2">
    </div>

    <div class="q-card fade-slide-in" id="card-C3">
      <p class="q-text"><span class="q-num">C3</span> Are customer relationships primarily held by the business or by the owner?</p>
      <div class="radio-group" id="rg-C3">
        <label class="radio-opt" onclick="selectRadio('C3','business',this)"><span class="radio-dot"></span>Business — contracts and relationships are institutional</label>
        <label class="radio-opt" onclick="selectRadio('C3','mostly_business',this)"><span class="radio-dot"></span>Mostly business — some owner involvement but transferable</label>
        <label class="radio-opt" onclick="selectRadio('C3','mixed',this)"><span class="radio-dot"></span>Mixed — owner and business team share relationships</label>
        <label class="radio-opt" onclick="selectRadio('C3','owner',this)"><span class="radio-dot"></span>Owner — most customers deal directly with owner personally</label>
      </div>
      <input type="hidden" id="C3" name="C3">
    </div>

    <div class="q-card fade-slide-in" id="card-C4">
      <p class="q-text"><span class="q-num">C4</span> What is your customer churn / retention rate?</p>
      <div class="radio-group" id="rg-C4">
        <label class="radio-opt" onclick="selectRadio('C4','excellent',this)"><span class="radio-dot"></span>Excellent — &gt;90% annual retention</label>
        <label class="radio-opt" onclick="selectRadio('C4','good',this)"><span class="radio-dot"></span>Good — 75 – 90% annual retention</label>
        <label class="radio-opt" onclick="selectRadio('C4','average',this)"><span class="radio-dot"></span>Average — 50 – 75% annual retention</label>
        <label class="radio-opt" onclick="selectRadio('C4','poor',this)"><span class="radio-dot"></span>Poor — below 50% retention</label>
      </div>
      <input type="hidden" id="C4" name="C4">
    </div>

    <div class="q-card fade-slide-in" id="card-C5">
      <p class="q-text"><span class="q-num">C5</span> Do you have formal contracts in place with your top customers?</p>
      <div class="radio-group" id="rg-C5">
        <label class="radio-opt" onclick="selectRadio('C5','all_contracted',this)"><span class="radio-dot"></span>Yes — all top customers on multi-year contracts</label>
        <label class="radio-opt" onclick="selectRadio('C5','most_contracted',this)"><span class="radio-dot"></span>Most — majority on 12-month+ contracts</label>
        <label class="radio-opt" onclick="selectRadio('C5','some_contracted',this)"><span class="radio-dot"></span>Some — mix of contracted and informal arrangements</label>
        <label class="radio-opt" onclick="selectRadio('C5','none_contracted',this)"><span class="radio-dot"></span>Informal — no formal contracts in place</label>
      </div>
      <input type="hidden" id="C5" name="C5">
    </div>

    <div class="nav-row">
      <button class="btn btn-secondary" onclick="goToSection(4)">&larr; Previous</button>
      <button class="btn btn-primary" onclick="validateAndGo(6)">Next: Operations &rarr;</button>
    </div>
  </div>


  <!-- ==================== SECTION 6: OPERATIONS ==================== -->
  <div class="section" id="s6">
    <div class="section-header fade-slide-in">
      <div class="section-badge">Section 6 of 13</div>
      <h2>Operations &amp; Systems</h2>
      <p>Assess the maturity of your operational infrastructure and processes.</p>
    </div>
    <div id="err-s6" class="error-banner"></div>

    <div class="q-card fade-slide-in" id="card-O1">
      <p class="q-text"><span class="q-num">O1</span> How well-documented are your core business processes and standard operating procedures?</p>
      <div class="radio-group" id="rg-O1">
        <label class="radio-opt" onclick="selectRadio('O1','fully_documented',this)"><span class="radio-dot"></span>Fully documented — SOPs for all key processes, regularly reviewed</label>
        <label class="radio-opt" onclick="selectRadio('O1','mostly_documented',this)"><span class="radio-dot"></span>Mostly documented — key processes written up, some gaps</label>
        <label class="radio-opt" onclick="selectRadio('O1','partially_documented',this)"><span class="radio-dot"></span>Partially documented — some key processes, mostly tribal knowledge</label>
        <label class="radio-opt" onclick="selectRadio('O1','undocumented',this)"><span class="radio-dot"></span>Largely undocumented — relies on key person knowledge</label>
      </div>
      <input type="hidden" id="O1" name="O1">
    </div>

    <div class="q-card fade-slide-in" id="card-O2">
      <p class="q-text"><span class="q-num">O2</span> What technology and systems does the business use to manage operations?</p>
      <div class="radio-group" id="rg-O2">
        <label class="radio-opt" onclick="selectRadio('O2','advanced',this)"><span class="radio-dot"></span>Advanced — integrated ERP/CRM, automation, real-time dashboards</label>
        <label class="radio-opt" onclick="selectRadio('O2','good',this)"><span class="radio-dot"></span>Good — modern cloud systems, CRM and accounting software</label>
        <label class="radio-opt" onclick="selectRadio('O2','basic',this)"><span class="radio-dot"></span>Basic — spreadsheets and entry-level software</label>
        <label class="radio-opt" onclick="selectRadio('O2','minimal',this)"><span class="radio-dot"></span>Minimal — paper-based or ad-hoc tools</label>
      </div>
      <input type="hidden" id="O2" name="O2">
    </div>

    <div class="q-card fade-slide-in" id="card-O3">
      <p class="q-text"><span class="q-num">O3</span> How scalable is the business model — can you grow revenue without proportional cost increases?</p>
      <div class="radio-group" id="rg-O3">
        <label class="radio-opt" onclick="selectRadio('O3','highly_scalable',this)"><span class="radio-dot"></span>Highly scalable — digital/platform model, near-zero marginal cost</label>
        <label class="radio-opt" onclick="selectRadio('O3','scalable',this)"><span class="radio-dot"></span>Scalable — can grow with modest headcount and capex increases</label>
        <label class="radio-opt" onclick="selectRadio('O3','limited',this)"><span class="radio-dot"></span>Somewhat scalable — growth requires proportional cost increases</label>
        <label class="radio-opt" onclick="selectRadio('O3','not_scalable',this)"><span class="radio-dot"></span>Linear — revenue and costs grow in lockstep</label>
      </div>
      <input type="hidden" id="O3" name="O3">
    </div>

    <div class="q-card fade-slide-in" id="card-O4">
      <p class="q-text"><span class="q-num">O4</span> What is the quality and reliability of your supply chain or key suppliers?</p>
      <div class="radio-group" id="rg-O4">
        <label class="radio-opt" onclick="selectRadio('O4','excellent',this)"><span class="radio-dot"></span>Excellent — multiple suppliers, low concentration risk, strong relationships</label>
        <label class="radio-opt" onclick="selectRadio('O4','good',this)"><span class="radio-dot"></span>Good — reliable suppliers with some alternatives available</label>
        <label class="radio-opt" onclick="selectRadio('O4','moderate',this)"><span class="radio-dot"></span>Moderate — some supplier concentration risk</label>
        <label class="radio-opt" onclick="selectRadio('O4','high_risk',this)"><span class="radio-dot"></span>High risk — sole-source supplier dependency</label>
      </div>
      <input type="hidden" id="O4" name="O4">
    </div>

    <div class="nav-row">
      <button class="btn btn-secondary" onclick="goToSection(5)">&larr; Previous</button>
      <button class="btn btn-primary" onclick="validateAndGo(7)">Next: Team &rarr;</button>
    </div>
  </div>

  <!-- ==================== SECTION 7: TEAM ==================== -->
  <div class="section" id="s7">
    <div class="section-header fade-slide-in">
      <div class="section-badge">Section 7 of 13</div>
      <h2>Leadership &amp; Team</h2>
      <p>Evaluate the depth, capability and stability of your management team.</p>
    </div>
    <div id="err-s7" class="error-banner"></div>

    <div class="q-card fade-slide-in" id="card-T1">
      <p class="q-text"><span class="q-num">T1</span> How capable and experienced is your senior management team?</p>
      <div class="radio-group" id="rg-T1">
        <label class="radio-opt" onclick="selectRadio('T1','strong_team',this)"><span class="radio-dot"></span>Strong experienced team — could run the business independently</label>
        <label class="radio-opt" onclick="selectRadio('T1','capable',this)"><span class="radio-dot"></span>Capable team — some gaps but overall strong</label>
        <label class="radio-opt" onclick="selectRadio('T1','developing',this)"><span class="radio-dot"></span>Developing — team in place but relies heavily on owner direction</label>
        <label class="radio-opt" onclick="selectRadio('T1','thin',this)"><span class="radio-dot"></span>Thin — owner is effectively the management team</label>
      </div>
      <input type="hidden" id="T1" name="T1">
    </div>

    <div class="q-card fade-slide-in" id="card-T2">
      <p class="q-text"><span class="q-num">T2</span> What is your staff turnover rate over the last 2 years?</p>
      <div class="radio-group" id="rg-T2">
        <label class="radio-opt" onclick="selectRadio('T2','very_low',this)"><span class="radio-dot"></span>Very low — below 10% annual turnover, highly stable team</label>
        <label class="radio-opt" onclick="selectRadio('T2','low',this)"><span class="radio-dot"></span>Low — 10 – 20% annual turnover</label>
        <label class="radio-opt" onclick="selectRadio('T2','moderate',this)"><span class="radio-dot"></span>Moderate — 20 – 35% annual turnover</label>
        <label class="radio-opt" onclick="selectRadio('T2','high',this)"><span class="radio-dot"></span>High — above 35% or significant key person departures</label>
      </div>
      <input type="hidden" id="T2" name="T2">
    </div>

    <div class="q-card fade-slide-in" id="card-T3">
      <p class="q-text"><span class="q-num">T3</span> Are there employment contracts, restraint clauses and incentive structures in place for key staff?</p>
      <div class="radio-group" id="rg-T3">
        <label class="radio-opt" onclick="selectRadio('T3','comprehensive',this)"><span class="radio-dot"></span>Comprehensive — contracts, restraints, KPIs and equity/bonus plans</label>
        <label class="radio-opt" onclick="selectRadio('T3','good',this)"><span class="radio-dot"></span>Good — contracts and basic incentives in place</label>
        <label class="radio-opt" onclick="selectRadio('T3','partial',this)"><span class="radio-dot"></span>Partial — some contracts, limited incentives</label>
        <label class="radio-opt" onclick="selectRadio('T3','minimal',this)"><span class="radio-dot"></span>Minimal — informal arrangements</label>
      </div>
      <input type="hidden" id="T3" name="T3">
    </div>

    <div class="q-card fade-slide-in" id="card-T4">
      <p class="q-text"><span class="q-num">T4</span> Does the business have a second-tier of leadership below the owner/CEO?</p>
      <div class="radio-group" id="rg-T4">
        <label class="radio-opt" onclick="selectRadio('T4','strong_second',this)"><span class="radio-dot"></span>Strong second tier — GM or Operations Manager who can lead independently</label>
        <label class="radio-opt" onclick="selectRadio('T4','some_second',this)"><span class="radio-dot"></span>Some — department heads in place, owner still needed strategically</label>
        <label class="radio-opt" onclick="selectRadio('T4','limited',this)"><span class="radio-dot"></span>Limited — one or two senior staff but no clear successor</label>
        <label class="radio-opt" onclick="selectRadio('T4','none',this)"><span class="radio-dot"></span>None — owner is the sole decision-maker</label>
      </div>
      <input type="hidden" id="T4" name="T4">
    </div>

    <div class="nav-row">
      <button class="btn btn-secondary" onclick="goToSection(6)">&larr; Previous</button>
      <button class="btn btn-primary" onclick="validateAndGo(8)">Next: Risk &rarr;</button>
    </div>
  </div>


  <!-- ==================== SECTION 8: RISK ==================== -->
  <div class="section" id="s8">
    <div class="section-header fade-slide-in">
      <div class="section-badge">Section 8 of 13</div>
      <h2>Risk Profile</h2>
      <p>Identify and assess the key risks that could impact business value.</p>
    </div>
    <div id="err-s8" class="error-banner"></div>

    <div class="q-card fade-slide-in" id="card-R1">
      <p class="q-text"><span class="q-num">R1</span> What is the regulatory and compliance risk exposure for your business?</p>
      <div class="radio-group" id="rg-R1">
        <label class="radio-opt" onclick="selectRadio('R1','low',this)"><span class="radio-dot"></span>Low — minimal regulatory requirements, fully compliant</label>
        <label class="radio-opt" onclick="selectRadio('R1','moderate',this)"><span class="radio-dot"></span>Moderate — some regulations, currently compliant with good processes</label>
        <label class="radio-opt" onclick="selectRadio('R1','elevated',this)"><span class="radio-dot"></span>Elevated — heavily regulated sector with compliance monitoring</label>
        <label class="radio-opt" onclick="selectRadio('R1','high',this)"><span class="radio-dot"></span>High — significant current compliance issues or pending regulatory changes</label>
      </div>
      <input type="hidden" id="R1" name="R1">
    </div>

    <div class="q-card fade-slide-in" id="card-R2">
      <p class="q-text"><span class="q-num">R2</span> Is the business adequately insured (PI, PL, key-person, cyber)?</p>
      <div class="radio-group" id="rg-R2">
        <label class="radio-opt" onclick="selectRadio('R2','comprehensive',this)"><span class="radio-dot"></span>Comprehensive — all relevant policies reviewed annually</label>
        <label class="radio-opt" onclick="selectRadio('R2','adequate',this)"><span class="radio-dot"></span>Adequate — core policies in place</label>
        <label class="radio-opt" onclick="selectRadio('R2','partial',this)"><span class="radio-dot"></span>Partial — some cover, known gaps</label>
        <label class="radio-opt" onclick="selectRadio('R2','minimal',this)"><span class="radio-dot"></span>Minimal — basic cover only or policies not reviewed recently</label>
      </div>
      <input type="hidden" id="R2" name="R2">
    </div>

    <div class="q-card fade-slide-in" id="card-R3">
      <p class="q-text"><span class="q-num">R3</span> Are there any pending or historical legal disputes, claims or IP issues?</p>
      <div class="radio-group" id="rg-R3">
        <label class="radio-opt" onclick="selectRadio('R3','none',this)"><span class="radio-dot"></span>None — clean legal history</label>
        <label class="radio-opt" onclick="selectRadio('R3','minor_resolved',this)"><span class="radio-dot"></span>Minor past issues — all fully resolved</label>
        <label class="radio-opt" onclick="selectRadio('R3','minor_pending',this)"><span class="radio-dot"></span>Minor pending matter — low materiality</label>
        <label class="radio-opt" onclick="selectRadio('R3','significant',this)"><span class="radio-dot"></span>Significant — material litigation, dispute or IP exposure</label>
      </div>
      <input type="hidden" id="R3" name="R3">
    </div>

    <div class="q-card fade-slide-in" id="card-R4">
      <p class="q-text"><span class="q-num">R4</span> How exposed is the business to macro-economic or industry disruption risks?</p>
      <div class="radio-group" id="rg-R4">
        <label class="radio-opt" onclick="selectRadio('R4','resilient',this)"><span class="radio-dot"></span>Resilient — counter-cyclical or essential service, proven through downturns</label>
        <label class="radio-opt" onclick="selectRadio('R4','moderate',this)"><span class="radio-dot"></span>Moderate — affected by cycles but manageable</label>
        <label class="radio-opt" onclick="selectRadio('R4','exposed',this)"><span class="radio-dot"></span>Exposed — discretionary spend or highly cyclical</label>
        <label class="radio-opt" onclick="selectRadio('R4','high',this)"><span class="radio-dot"></span>High — facing disruption threat or structural market decline</label>
      </div>
      <input type="hidden" id="R4" name="R4">
    </div>

    <div class="nav-row">
      <button class="btn btn-secondary" onclick="goToSection(7)">&larr; Previous</button>
      <button class="btn btn-primary" onclick="validateAndGo(9)">Next: Innovation &rarr;</button>
    </div>
  </div>

  <!-- ==================== SECTION 9: INNOVATION ==================== -->
  <div class="section" id="s9">
    <div class="section-header fade-slide-in">
      <div class="section-badge">Section 9 of 13</div>
      <h2>Innovation &amp; Technology</h2>
      <p>Assess the role of innovation and technology in your business.</p>
    </div>
    <div id="err-s9" class="error-banner"></div>

    <div class="q-card fade-slide-in" id="card-I1">
      <p class="q-text"><span class="q-num">I1</span> How actively does the business invest in and adopt new technology?</p>
      <div class="radio-group" id="rg-I1">
        <label class="radio-opt" onclick="selectRadio('I1','leader',this)"><span class="radio-dot"></span>Technology leader — early adopter, competitive advantage from tech</label>
        <label class="radio-opt" onclick="selectRadio('I1','progressive',this)"><span class="radio-dot"></span>Progressive — adopts proven technology, keeps up with sector</label>
        <label class="radio-opt" onclick="selectRadio('I1','average',this)"><span class="radio-dot"></span>Average — uses standard tools, no strategic tech investment</label>
        <label class="radio-opt" onclick="selectRadio('I1','laggard',this)"><span class="radio-dot"></span>Laggard — behind sector in technology adoption</label>
      </div>
      <input type="hidden" id="I1" name="I1">
    </div>

    <div class="q-card fade-slide-in" id="card-I2">
      <p class="q-text"><span class="q-num">I2</span> Does the business have proprietary products, software, or intellectual property?</p>
      <div class="radio-group" id="rg-I2">
        <label class="radio-opt" onclick="selectRadio('I2','significant_ip',this)"><span class="radio-dot"></span>Significant registered IP — patents, trademarks, proprietary software</label>
        <label class="radio-opt" onclick="selectRadio('I2','some_ip',this)"><span class="radio-dot"></span>Some IP — trade secrets, brand, unregistered know-how</label>
        <label class="radio-opt" onclick="selectRadio('I2','minimal_ip',this)"><span class="radio-dot"></span>Minimal IP — primarily uses third-party tools and platforms</label>
        <label class="radio-opt" onclick="selectRadio('I2','no_ip',this)"><span class="radio-dot"></span>No proprietary IP</label>
      </div>
      <input type="hidden" id="I2" name="I2">
    </div>

    <div class="q-card fade-slide-in" id="card-I3">
      <p class="q-text"><span class="q-num">I3</span> How would you rate the business's overall culture of innovation and improvement?</p>
      <div class="radio-group" id="rg-I3">
        <label class="radio-opt" onclick="selectRadio('I3','strong',this)"><span class="radio-dot"></span>Strong — continuous improvement embedded, regular R&D or product investment</label>
        <label class="radio-opt" onclick="selectRadio('I3','active',this)"><span class="radio-dot"></span>Active — improvement projects underway, open to change</label>
        <label class="radio-opt" onclick="selectRadio('I3','limited',this)"><span class="radio-dot"></span>Limited — reactive, changes only when necessary</label>
        <label class="radio-opt" onclick="selectRadio('I3','resistant',this)"><span class="radio-dot"></span>Resistant — entrenched ways of working, change is difficult</label>
      </div>
      <input type="hidden" id="I3" name="I3">
    </div>

    <div class="nav-row">
      <button class="btn btn-secondary" onclick="goToSection(8)">&larr; Previous</button>
      <button class="btn btn-primary" onclick="validateAndGo(10)">Next: Brand &rarr;</button>
    </div>
  </div>


  <!-- ==================== SECTION 10: BRAND ==================== -->
  <div class="section" id="s10">
    <div class="section-header fade-slide-in">
      <div class="section-badge">Section 10 of 13</div>
      <h2>Brand &amp; Market Position</h2>
      <p>Evaluate the strength of your brand and market standing.</p>
    </div>
    <div id="err-s10" class="error-banner"></div>

    <div class="q-card fade-slide-in" id="card-BR1">
      <p class="q-text"><span class="q-num">BR1</span> How strong and recognisable is your brand in your target market?</p>
      <div class="radio-group" id="rg-BR1">
        <label class="radio-opt" onclick="selectRadio('BR1','market_leader',this)"><span class="radio-dot"></span>Market leader — top-of-mind brand, strong reputation, awards</label>
        <label class="radio-opt" onclick="selectRadio('BR1','well_known',this)"><span class="radio-dot"></span>Well known — recognised within sector, good online presence</label>
        <label class="radio-opt" onclick="selectRadio('BR1','developing',this)"><span class="radio-dot"></span>Developing — some awareness, building brand profile</label>
        <label class="radio-opt" onclick="selectRadio('BR1','unknown',this)"><span class="radio-dot"></span>Low awareness — brand is not a competitive differentiator</label>
      </div>
      <input type="hidden" id="BR1" name="BR1">
    </div>

    <div class="q-card fade-slide-in" id="card-BR2">
      <p class="q-text"><span class="q-num">BR2</span> What is your online and digital marketing presence?</p>
      <div class="radio-group" id="rg-BR2">
        <label class="radio-opt" onclick="selectRadio('BR2','excellent',this)"><span class="radio-dot"></span>Excellent — strong SEO, active social media, Google reviews 4.5+, content marketing</label>
        <label class="radio-opt" onclick="selectRadio('BR2','good',this)"><span class="radio-dot"></span>Good — maintained website, social presence, reasonable reviews</label>
        <label class="radio-opt" onclick="selectRadio('BR2','basic',this)"><span class="radio-dot"></span>Basic — website exists, occasional social media activity</label>
        <label class="radio-opt" onclick="selectRadio('BR2','poor',this)"><span class="radio-dot"></span>Minimal — outdated or no meaningful online presence</label>
      </div>
      <input type="hidden" id="BR2" name="BR2">
    </div>

    <div class="q-card fade-slide-in" id="card-BR3">
      <p class="q-text"><span class="q-num">BR3</span> Does the business generate inbound leads and referrals organically?</p>
      <div class="radio-group" id="rg-BR3">
        <label class="radio-opt" onclick="selectRadio('BR3','strong_inbound',this)"><span class="radio-dot"></span>Strong — majority of new business comes inbound or from referrals</label>
        <label class="radio-opt" onclick="selectRadio('BR3','mixed',this)"><span class="radio-dot"></span>Mixed — roughly half inbound/referral, half outbound</label>
        <label class="radio-opt" onclick="selectRadio('BR3','mostly_outbound',this)"><span class="radio-dot"></span>Mostly outbound — relies on active selling and business development</label>
        <label class="radio-opt" onclick="selectRadio('BR3','fully_outbound',this)"><span class="radio-dot"></span>Fully outbound — no meaningful inbound or referral pipeline</label>
      </div>
      <input type="hidden" id="BR3" name="BR3">
    </div>

    <div class="nav-row">
      <button class="btn btn-secondary" onclick="goToSection(9)">&larr; Previous</button>
      <button class="btn btn-primary" onclick="validateAndGo(11)">Next: Strategy &rarr;</button>
    </div>
  </div>

  <!-- ==================== SECTION 11: STRATEGY ==================== -->
  <div class="section" id="s11">
    <div class="section-header fade-slide-in">
      <div class="section-badge">Section 11 of 13</div>
      <h2>Strategy &amp; Planning</h2>
      <p>Evaluate the quality and execution of your strategic planning.</p>
    </div>
    <div id="err-s11" class="error-banner"></div>

    <div class="q-card fade-slide-in" id="card-S1">
      <p class="q-text"><span class="q-num">S1</span> Does the business have a documented strategic plan (1–3 year horizon)?</p>
      <div class="radio-group" id="rg-S1">
        <label class="radio-opt" onclick="selectRadio('S1','formal_plan',this)"><span class="radio-dot"></span>Yes — formal written plan with KPIs, reviewed quarterly</label>
        <label class="radio-opt" onclick="selectRadio('S1','basic_plan',this)"><span class="radio-dot"></span>Yes — documented goals and priorities, reviewed annually</label>
        <label class="radio-opt" onclick="selectRadio('S1','informal',this)"><span class="radio-dot"></span>Informal — owner has a plan in their head, not documented</label>
        <label class="radio-opt" onclick="selectRadio('S1','no_plan',this)"><span class="radio-dot"></span>No strategic plan — reactive management</label>
      </div>
      <input type="hidden" id="S1" name="S1">
    </div>

    <div class="q-card fade-slide-in" id="card-S2">
      <p class="q-text"><span class="q-num">S2</span> How well does the leadership team execute on its plans and targets?</p>
      <div class="radio-group" id="rg-S2">
        <label class="radio-opt" onclick="selectRadio('S2','excellent',this)"><span class="radio-dot"></span>Excellent — consistently meets or exceeds targets</label>
        <label class="radio-opt" onclick="selectRadio('S2','good',this)"><span class="radio-dot"></span>Good — generally hits targets with some misses</label>
        <label class="radio-opt" onclick="selectRadio('S2','average',this)"><span class="radio-dot"></span>Average — mixed execution record</label>
        <label class="radio-opt" onclick="selectRadio('S2','poor',this)"><span class="radio-dot"></span>Poor — plans rarely executed as intended</label>
      </div>
      <input type="hidden" id="S2" name="S2">
    </div>

    <div class="q-card fade-slide-in" id="card-S3">
      <p class="q-text"><span class="q-num">S3</span> Does the business have a Board, Advisory Board or access to experienced external advisors?</p>
      <div class="radio-group" id="rg-S3">
        <label class="radio-opt" onclick="selectRadio('S3','formal_board',this)"><span class="radio-dot"></span>Formal Board — independent directors, regular meetings</label>
        <label class="radio-opt" onclick="selectRadio('S3','advisory',this)"><span class="radio-dot"></span>Advisory Board — engaged advisors with relevant experience</label>
        <label class="radio-opt" onclick="selectRadio('S3','informal_advisors',this)"><span class="radio-dot"></span>Informal advisors — accountant, lawyer or mentor consulted occasionally</label>
        <label class="radio-opt" onclick="selectRadio('S3','none',this)"><span class="radio-dot"></span>None — owner makes all strategic decisions alone</label>
      </div>
      <input type="hidden" id="S3" name="S3">
    </div>

    <div class="nav-row">
      <button class="btn btn-secondary" onclick="goToSection(10)">&larr; Previous</button>
      <button class="btn btn-primary" onclick="validateAndGo(12)">Next: Exit Readiness &rarr;</button>
    </div>
  </div>

  <!-- ==================== SECTION 12: EXIT ==================== -->
  <div class="section" id="s12">
    <div class="section-header fade-slide-in">
      <div class="section-badge">Section 12 of 13</div>
      <h2>Exit Readiness</h2>
      <p>Assess how prepared the business is for a future ownership transition or sale.</p>
    </div>
    <div id="err-s12" class="error-banner"></div>

    <div class="q-card fade-slide-in" id="card-E1">
      <p class="q-text"><span class="q-num">E1</span> What is the owner's likely exit horizon?</p>
      <div class="radio-group" id="rg-E1">
        <label class="radio-opt" onclick="selectRadio('E1','over5yr',this)"><span class="radio-dot"></span>More than 5 years — long runway to prepare</label>
        <label class="radio-opt" onclick="selectRadio('E1','3to5yr',this)"><span class="radio-dot"></span>3 – 5 years</label>
        <label class="radio-opt" onclick="selectRadio('E1','1to3yr',this)"><span class="radio-dot"></span>1 – 3 years</label>
        <label class="radio-opt" onclick="selectRadio('E1','under1yr',this)"><span class="radio-dot"></span>Within 12 months — imminent sale</label>
      </div>
      <input type="hidden" id="E1" name="E1">
    </div>

    <div class="q-card fade-slide-in" id="card-E2">
      <p class="q-text"><span class="q-num">E2</span> How prepared is the business for a due diligence process?</p>
      <div class="radio-group" id="rg-E2">
        <label class="radio-opt" onclick="selectRadio('E2','fully_ready',this)"><span class="radio-dot"></span>Fully ready — data room prepared, all records organised</label>
        <label class="radio-opt" onclick="selectRadio('E2','mostly_ready',this)"><span class="radio-dot"></span>Mostly ready — minor gaps to address</label>
        <label class="radio-opt" onclick="selectRadio('E2','partially_ready',this)"><span class="radio-dot"></span>Partially ready — significant preparation required (6–12 months)</label>
        <label class="radio-opt" onclick="selectRadio('E2','not_ready',this)"><span class="radio-dot"></span>Not ready — significant work needed to prepare</label>
      </div>
      <input type="hidden" id="E2" name="E2">
    </div>

    <div class="q-card fade-slide-in" id="card-E3">
      <p class="q-text"><span class="q-num">E3</span> What is the preferred exit/succession strategy?</p>
      <div class="radio-group" id="rg-E3">
        <label class="radio-opt" onclick="selectRadio('E3','trade_sale',this)"><span class="radio-dot"></span>Trade sale — sell to a strategic or industry buyer</label>
        <label class="radio-opt" onclick="selectRadio('E3','pe_backed',this)"><span class="radio-dot"></span>Private equity or management buyout</label>
        <label class="radio-opt" onclick="selectRadio('E3','family',this)"><span class="radio-dot"></span>Family succession</label>
        <label class="radio-opt" onclick="selectRadio('E3','undecided',this)"><span class="radio-dot"></span>Undecided — exploring options</label>
      </div>
      <input type="hidden" id="E3" name="E3">
    </div>

    <div class="q-card fade-slide-in" id="card-E4">
      <p class="q-text"><span class="q-num">E4</span> Has the business undergone a formal valuation or sale process previously?</p>
      <div class="radio-group" id="rg-E4">
        <label class="radio-opt" onclick="selectRadio('E4','formal_val',this)"><span class="radio-dot"></span>Yes — formal valuation by qualified professional in last 2 years</label>
        <label class="radio-opt" onclick="selectRadio('E4','informal_val',this)"><span class="radio-dot"></span>Informal — accountant or advisor estimate only</label>
        <label class="radio-opt" onclick="selectRadio('E4','prior_process',this)"><span class="radio-dot"></span>Yes — went through a sale process (even if not completed)</label>
        <label class="radio-opt" onclick="selectRadio('E4','never',this)"><span class="radio-dot"></span>Never formally valued</label>
      </div>
      <input type="hidden" id="E4" name="E4">
    </div>

    <div class="nav-row">
      <button class="btn btn-secondary" onclick="goToSection(11)">&larr; Previous</button>
      <button class="btn btn-primary" onclick="validateAndGo(13)">Next: Capacity &rarr;</button>
    </div>
  </div>


  <!-- ==================== SECTION 13: CAPACITY ==================== -->
  <div class="section" id="s13">
    <div class="section-header fade-slide-in">
      <div class="section-badge">Section 13 of 13</div>
      <h2>Capacity &amp; Additional Comments</h2>
      <p>Final questions about your business's capacity for growth and any additional context you'd like to share.</p>
    </div>
    <div id="err-s13" class="error-banner"></div>

    <div class="q-card fade-slide-in" id="card-CA1">
      <p class="q-text"><span class="q-num">CA1</span> What is the current physical or operational capacity utilisation of the business?</p>
      <div class="radio-group" id="rg-CA1">
        <label class="radio-opt" onclick="selectRadio('CA1','significant_headroom',this)"><span class="radio-dot"></span>Significant headroom — can grow 50%+ without major capital investment</label>
        <label class="radio-opt" onclick="selectRadio('CA1','some_headroom',this)"><span class="radio-dot"></span>Some headroom — can grow 20–50% with modest investment</label>
        <label class="radio-opt" onclick="selectRadio('CA1','near_capacity',this)"><span class="radio-dot"></span>Near capacity — growth requires significant capital investment</label>
        <label class="radio-opt" onclick="selectRadio('CA1','at_capacity',this)"><span class="radio-dot"></span>At capacity — currently constrained, cannot grow without investment</label>
      </div>
      <input type="hidden" id="CA1" name="CA1">
    </div>

    <div class="q-card fade-slide-in" id="card-CA2">
      <p class="q-text"><span class="q-num">CA2</span> How would you rate the quality and scalability of your current team?</p>
      <div class="radio-group" id="rg-CA2">
        <label class="radio-opt" onclick="selectRadio('CA2','highly_scalable',this)"><span class="radio-dot"></span>Highly scalable — team can absorb significant growth without restructuring</label>
        <label class="radio-opt" onclick="selectRadio('CA2','scalable',this)"><span class="radio-dot"></span>Scalable — can grow with targeted hiring in key roles</label>
        <label class="radio-opt" onclick="selectRadio('CA2','some_limitations',this)"><span class="radio-dot"></span>Some limitations — key bottlenecks in specific functions</label>
        <label class="radio-opt" onclick="selectRadio('CA2','constrained',this)"><span class="radio-dot"></span>Constrained — team at limits, restructuring needed for growth</label>
      </div>
      <input type="hidden" id="CA2" name="CA2">
    </div>

    <div class="q-card fade-slide-in" id="card-CA3">
      <p class="q-text"><span class="q-num">CA3</span> What is your access to growth capital if needed?</p>
      <div class="radio-group" id="rg-CA3">
        <label class="radio-opt" onclick="selectRadio('CA3','strong_access',this)"><span class="radio-dot"></span>Strong — existing banking relationships, low gearing, equity capacity</label>
        <label class="radio-opt" onclick="selectRadio('CA3','adequate',this)"><span class="radio-dot"></span>Adequate — could raise capital with some effort</label>
        <label class="radio-opt" onclick="selectRadio('CA3','limited',this)"><span class="radio-dot"></span>Limited — currently near borrowing capacity</label>
        <label class="radio-opt" onclick="selectRadio('CA3','constrained',this)"><span class="radio-dot"></span>Constrained — limited or no access to additional capital</label>
      </div>
      <input type="hidden" id="CA3" name="CA3">
    </div>

    <div class="card fade-slide-in" id="card-CA4">
      <h3>&#128172; Additional Comments</h3>
      <div class="field-group">
        <label for="CA4_context">Is there anything else about the business that is important for valuation context?</label>
        <textarea id="CA4_context" rows="4" placeholder="e.g. pending contracts, recent acquisitions, planned product launches, unique competitive advantages..." oninput="saveState()"></textarea>
      </div>
      <div class="field-group">
        <label for="CA4_concerns">Are there any known risks or challenges that should be considered?</label>
        <textarea id="CA4_concerns" rows="4" placeholder="e.g. key person dependency, lease expiry, technology transition, competitive threats..." oninput="saveState()"></textarea>
      </div>
      <div class="field-group">
        <label for="CA4_goals">What are your primary goals from this valuation assessment?</label>
        <textarea id="CA4_goals" rows="3" placeholder="e.g. understanding business value before sale, benchmarking for improvement, insurance, estate planning..." oninput="saveState()"></textarea>
      </div>
    </div>

    <div class="nav-row">
      <button class="btn btn-secondary" onclick="goToSection(12)">&larr; Previous</button>
      <button class="btn btn-success" onclick="validateAndGo(14)">&#9989; Generate Valuation Report</button>
    </div>
  </div>

  <!-- ==================== RESULTS ==================== -->
  <div id="results">

    <div class="results-hero fade-slide-in">
      <h2>&#127970; Indicative Business Valuation</h2>
      <div class="range-display" id="res-value-range">—</div>
      <div class="results-meta" id="res-meta">Based on normalised EBITDA and quality-adjusted sector multiple</div>
      <div class="quality-hero">
        <div>
          <div class="quality-hero-label">Overall Business Quality Score</div>
          <div class="quality-hero-score" id="res-quality-score">—</div>
        </div>
        <div class="quality-hero-bar">
          <div class="quality-hero-bar-fill" id="res-quality-bar"></div>
        </div>
        <div id="res-quality-label" style="font-size:14px;font-weight:700;"></div>
      </div>
    </div>

    <div class="results-grid">

      <!-- Financial Summary -->
      <div class="results-card">
        <h3>&#128176; Financial Summary</h3>
        <div id="res-financials"></div>
      </div>

      <!-- Valuation Detail -->
      <div class="results-card">
        <h3>&#128200; Valuation Detail</h3>
        <div id="res-valuation-detail"></div>
      </div>

      <!-- Value Driver Scorecard -->
      <div class="results-card results-card-full">
        <h3>&#127942; Value Driver Scorecard</h3>
        <div id="res-scorecard"></div>
      </div>

      <!-- Observations -->
      <div class="results-card results-card-full">
        <h3>&#128270; Key Observations &amp; Recommendations</h3>
        <div class="obs-list" id="res-observations"></div>
      </div>

    </div>

    <!-- Advisor Lead Capture -->
    <div class="advisor-capture fade-slide-in">
      <h3>Want Expert Guidance on Maximising Your Business Value?</h3>
      <p>Our network of accredited M&amp;A advisors and business brokers can provide a confidential conversation about your next steps — at no cost to you.</p>
      <form name="advisor-enquiry" netlify netlify-honeypot="bot-field" onsubmit="submitAdvisorForm(event)">
        <input type="hidden" name="form-name" value="advisor-enquiry">
        <p style="display:none;"><label>Don't fill this out: <input name="bot-field"></label></p>
        <div class="advisor-form-grid">
          <div class="field-group">
            <label for="adv-name">Your Full Name *</label>
            <input type="text" id="adv-name" name="adv-name" placeholder="Jane Smith" required>
          </div>
          <div class="field-group">
            <label for="adv-email">Email Address *</label>
            <input type="email" id="adv-email" name="adv-email" placeholder="jane@company.com.au" required>
          </div>
          <div class="field-group">
            <label for="adv-phone">Mobile / Phone</label>
            <input type="tel" id="adv-phone" name="adv-phone" placeholder="04xx xxx xxx">
          </div>
          <div class="field-group">
            <label for="adv-timeline">Exit / Sale Timeline</label>
            <select id="adv-timeline" name="adv-timeline">
              <option value="">— Select —</option>
              <option value="immediate">Immediate (&lt;6 months)</option>
              <option value="1yr">Within 1 year</option>
              <option value="1to3yr">1 – 3 years</option>
              <option value="3to5yr">3 – 5 years</option>
              <option value="exploring">Just exploring options</option>
            </select>
          </div>
        </div>
        <input type="hidden" name="business-name" id="adv-biz-name">
        <input type="hidden" name="valuation-range" id="adv-val-range">
        <input type="hidden" name="quality-score" id="adv-qual-score">
        <button type="submit" class="btn-advisor">Connect Me With an Advisor &rarr;</button>
      </form>
      <div class="advisor-success" id="advisor-success">
        <strong>&#10003; Thank you!</strong> An accredited advisor from our network will be in touch within 1 business day. Your report has been noted.
      </div>
    </div>

    <div class="disclaimer">
      <strong>Disclaimer:</strong> This assessment provides an indicative valuation range only and does not constitute financial, legal or investment advice. Actual transaction values depend on many factors including market conditions, buyer appetite, due diligence findings and deal structure. This tool is provided for general guidance purposes by the SME Association of Australia. Engage a qualified business valuation specialist for a formal opinion of value.
    </div>

  </div><!-- end #results -->

</div><!-- end #main-wrap -->

<script>
// ============================================================
// CONSTANTS
// ============================================================
const STORAGE_KEY = 'bvq_v2';

// ── CURRENCIES ──────────────────────────────────────────────
const CURRENCIES = {
  AU: { symbol: 'A$',  code: 'AUD', name: 'Australian Dollar', locale: 'en-AU', flag: '🇦🇺' },
  US: { symbol: 'US$', code: 'USD', name: 'US Dollar',          locale: 'en-US', flag: '🇺🇸' },
  CA: { symbol: 'C$',  code: 'CAD', name: 'Canadian Dollar',    locale: 'en-CA', flag: '🇨🇦' },
  GB: { symbol: '£',   code: 'GBP', name: 'British Pound',      locale: 'en-GB', flag: '🇬🇧' },
};
let selectedCurrency = CURRENCIES.AU;

// ── STATES / PROVINCES / COUNTIES ───────────────────────────
const REGIONS = {
  AU: ['Australian Capital Territory','New South Wales','Northern Territory','Queensland','South Australia','Tasmania','Victoria','Western Australia'],
  US: ['Alabama','Alaska','Arizona','Arkansas','California','Colorado','Connecticut','Delaware','Florida','Georgia','Hawaii','Idaho','Illinois','Indiana','Iowa','Kansas','Kentucky','Louisiana','Maine','Maryland','Massachusetts','Michigan','Minnesota','Mississippi','Missouri','Montana','Nebraska','Nevada','New Hampshire','New Jersey','New Mexico','New York','North Carolina','North Dakota','Ohio','Oklahoma','Oregon','Pennsylvania','Rhode Island','South Carolina','South Dakota','Tennessee','Texas','Utah','Vermont','Virginia','Washington','West Virginia','Wisconsin','Wyoming','Washington D.C.'],
  CA: ['Alberta','British Columbia','Manitoba','New Brunswick','Newfoundland & Labrador','Northwest Territories','Nova Scotia','Nunavut','Ontario','Prince Edward Island','Québec','Saskatchewan','Yukon'],
  GB: ['England — East Midlands','England — East of England','England — Greater London','England — North East','England — North West','England — South East','England — South West','England — West Midlands','England — Yorkshire & the Humber','Northern Ireland','Scotland','Wales'],
};

function onCountryChange() {
  const country = document.getElementById('bizCountry').value;
  const stateEl = document.getElementById('bizState');

  // populate state dropdown
  stateEl.innerHTML = '<option value="">— Select region —</option>';
  if (country && REGIONS[country]) {
    REGIONS[country].forEach(r => {
      const o = document.createElement('option');
      o.value = r; o.textContent = r;
      stateEl.appendChild(o);
    });
    stateEl.disabled = false;
  } else {
    stateEl.innerHTML = '<option value="">— Select country first —</option>';
    stateEl.disabled = true;
  }

  // set currency
  const cur = CURRENCIES[country] || null;
  selectedCurrency = cur || CURRENCIES.AU;
  document.getElementById('curFlag').textContent   = cur ? cur.flag   : '🌐';
  document.getElementById('curSymBig').textContent = cur ? cur.symbol : '—';
  document.getElementById('curNameSm').textContent = cur ? cur.name   : 'Select a country';

  // update all cur-sym spans throughout the form
  document.querySelectorAll('.cur-sym').forEach(el => el.textContent = selectedCurrency.symbol);
  updateCalc();
}

const SECTIONS = [
  { id: 's1',  name: 'Intake',       short: 'Intake' },
  { id: 's2',  name: 'Financials',   short: 'Financials' },
  { id: 's3',  name: 'Deep Dive',    short: 'Deep Dive' },
  { id: 's4',  name: 'Growth',       short: 'Growth' },
  { id: 's5',  name: 'Customers',    short: 'Customers' },
  { id: 's6',  name: 'Operations',   short: 'Operations' },
  { id: 's7',  name: 'Team',         short: 'Team' },
  { id: 's8',  name: 'Risk',         short: 'Risk' },
  { id: 's9',  name: 'Innovation',   short: 'Innovation' },
  { id: 's10', name: 'Brand',        short: 'Brand' },
  { id: 's11', name: 'Strategy',     short: 'Strategy' },
  { id: 's12', name: 'Exit',         short: 'Exit' },
  { id: 's13', name: 'Capacity',     short: 'Capacity' },
];

// Fields tracked per section for completion %
const SECTION_TRACKED = {
  s1:  ['bizCountry','bizState','legalName','industry','headcount','yearFounded','contactName','contactEmail'],
  s2:  ['B1','B2','B3','B4','B5','B6','B7','B8','B9','B10','B11','BGPM'],
  s3:  ['D1','D2b','D3','D4','D5','D6'],
  s4:  ['G1','G2','G3','G4','G5'],
  s5:  ['C1','C2','C3','C4','C5'],
  s6:  ['O1','O2','O3','O4'],
  s7:  ['T1','T2','T3','T4'],
  s8:  ['R1','R2','R3','R4'],
  s9:  ['I1','I2','I3'],
  s10: ['BR1','BR2','BR3'],
  s11: ['S1','S2','S3'],
  s12: ['E1','E2','E3','E4'],
  s13: ['CA1','CA2','CA3'],
};

// Score maps: each question's values map to 0-3 scores
const SCORE_MAPS = {
  // Section 2 - Financials
  B3:   { growing_fast: 3, growing: 2, flat: 1, declining: 0 },
  B4:   { above25: 3, '15to25': 2, '5to15': 1, below5: 0 },
  B5:   { highly_recurring: 3, mostly_recurring: 2, partly_recurring: 1, transactional: 0 },
  B6:   { well_spread: 3, moderate: 2, concentrated: 1, highly_concentrated: 0 },
  B7:   { under15: 3, '15to30': 2, '30to60': 1, over60: 0 },
  B8:   { strong_positive: 3, adequate: 2, tight: 1, negative: 0 },
  B9:   { audited: 3, reviewed: 2, internal: 1, basic: 0 },
  B10:  { none: 3, manageable: 2, moderate: 1, high: 0 },
  B11:  { top_quartile: 3, above_avg: 2, average: 1, below_avg: 0 },
  BGPM: { high: 3, good: 2, moderate: 1, low: 0 },
  // Section 3 - Deep Dive
  D4:   { fully_independent: 3, largely_independent: 2, partially_dependent: 1, highly_dependent: 0 },
  D5:   { comprehensive: 3, good: 2, basic: 1, minimal: 0 },
  D6:   { high_growth: 3, steady_growth: 2, mature: 1, declining: 0 },
  // Section 4 - Growth
  G1:   { strong: 3, good: 2, moderate: 1, weak: 0 },
  G2:   { active_multi: 3, active_one: 2, planned: 1, none: 0 },
  G3:   { excellent: 3, good: 2, average: 1, poor: 0 },
  G4:   { large: 3, moderate: 2, limited: 1, declining: 0 },
  G5:   { strong_moat: 3, moderate_moat: 2, weak_moat: 1, no_moat: 0 },
  // Section 5 - Customers
  C1:   { over5yr: 3, '2to5yr': 2, '1to2yr': 1, under1yr: 0 },
  C2:   { over500: 3, '100to500': 2, '20to100': 1, under20: 0 },
  C3:   { business: 3, mostly_business: 2, mixed: 1, owner: 0 },
  C4:   { excellent: 3, good: 2, average: 1, poor: 0 },
  C5:   { all_contracted: 3, most_contracted: 2, some_contracted: 1, none_contracted: 0 },
  // Section 6 - Operations
  O1:   { fully_documented: 3, mostly_documented: 2, partially_documented: 1, undocumented: 0 },
  O2:   { advanced: 3, good: 2, basic: 1, minimal: 0 },
  O3:   { highly_scalable: 3, scalable: 2, limited: 1, not_scalable: 0 },
  O4:   { excellent: 3, good: 2, moderate: 1, high_risk: 0 },
  // Section 7 - Team
  T1:   { strong_team: 3, capable: 2, developing: 1, thin: 0 },
  T2:   { very_low: 3, low: 2, moderate: 1, high: 0 },
  T3:   { comprehensive: 3, good: 2, partial: 1, minimal: 0 },
  T4:   { strong_second: 3, some_second: 2, limited: 1, none: 0 },
  // Section 8 - Risk
  R1:   { low: 3, moderate: 2, elevated: 1, high: 0 },
  R2:   { comprehensive: 3, adequate: 2, partial: 1, minimal: 0 },
  R3:   { none: 3, minor_resolved: 2, minor_pending: 1, significant: 0 },
  R4:   { resilient: 3, moderate: 2, exposed: 1, high: 0 },
  // Section 9 - Innovation
  I1:   { leader: 3, progressive: 2, average: 1, laggard: 0 },
  I2:   { significant_ip: 3, some_ip: 2, minimal_ip: 1, no_ip: 0 },
  I3:   { strong: 3, active: 2, limited: 1, resistant: 0 },
  // Section 10 - Brand
  BR1:  { market_leader: 3, well_known: 2, developing: 1, unknown: 0 },
  BR2:  { excellent: 3, good: 2, basic: 1, poor: 0 },
  BR3:  { strong_inbound: 3, mixed: 2, mostly_outbound: 1, fully_outbound: 0 },
  // Section 11 - Strategy
  S1:   { formal_plan: 3, basic_plan: 2, informal: 1, no_plan: 0 },
  S2:   { excellent: 3, good: 2, average: 1, poor: 0 },
  S3:   { formal_board: 3, advisory: 2, informal_advisors: 1, none: 0 },
  // Section 12 - Exit
  E1:   { over5yr: 2, '3to5yr': 3, '1to3yr': 2, under1yr: 1 },
  E2:   { fully_ready: 3, mostly_ready: 2, partially_ready: 1, not_ready: 0 },
  E3:   { trade_sale: 3, pe_backed: 3, family: 2, undecided: 1 },
  E4:   { formal_val: 3, informal_val: 2, prior_process: 2, never: 0 },
  // Section 13 - Capacity
  CA1:  { significant_headroom: 3, some_headroom: 2, near_capacity: 1, at_capacity: 0 },
  CA2:  { highly_scalable: 3, scalable: 2, some_limitations: 1, constrained: 0 },
  CA3:  { strong_access: 3, adequate: 2, limited: 1, constrained: 0 },
};

// Category definitions with question lists and weights
const SCORE_CATEGORIES = {
  financials:  { weight: 0.20, questions: ['B3','B4','B5','B6','B7','B8','B9','B10','B11','BGPM','D4','D5','D6'] },
  customers:   { weight: 0.15, questions: ['C1','C2','C3','C4','C5'] },
  team:        { weight: 0.15, questions: ['T1','T2','T3','T4'] },
  growth:      { weight: 0.12, questions: ['G1','G2','G3','G4','G5'] },
  risk:        { weight: 0.10, questions: ['R1','R2','R3','R4'] },
  innovation:  { weight: 0.08, questions: ['I1','I2','I3'] },
  brand:       { weight: 0.08, questions: ['BR1','BR2','BR3'] },
  strategy:    { weight: 0.07, questions: ['S1','S2','S3'] },
  exit:        { weight: 0.05, questions: ['E1','E2','E3','E4'] },
  capacity:    { weight: 0.05, questions: ['CA1','CA2','CA3'] },
};

// ANZSIC industry to D1 sector mapping
const INDUSTRY_TO_SECTOR = {
  agri:   'agri',
  mining: 'mining',
  manuf:  'manuf',
  util:   'util',
  const:  'const',
  trade:  'trade',
  retail: 'retail',
  accom:  'accom',
  trans:  'trans',
  media:  'media',
  fin:    'fin',
  prop:   'prop',
  prof:   'prof',
  admin:  'admin',
  edu:    'edu',
  health: 'health',
  arts:   'arts',
  other:  'other',
};

// Sector multiple ranges [low, high]
const SECTOR_MULTIPLES = {
  agri:   [2.5, 4.0],
  mining: [3.0, 5.0],
  manuf:  [3.5, 5.5],
  util:   [5.0, 8.0],
  const:  [2.5, 4.0],
  trade:  [2.5, 4.0],
  retail: [2.0, 4.0],
  accom:  [2.0, 3.5],
  trans:  [3.0, 5.0],
  media:  [4.0, 8.0],
  fin:    [4.0, 7.0],
  prop:   [3.0, 5.0],
  prof:   [3.5, 6.0],
  admin:  [3.0, 5.0],
  edu:    [3.5, 6.0],
  health: [4.0, 7.0],
  arts:   [2.5, 4.5],
  other:  [2.5, 4.0],
};

// ============================================================
// STATE
// ============================================================
let currentSection = null;
let autosaveTimer = null;

function getFieldValue(id) {
  // Check for radio hidden input first
  const el = document.getElementById(id);
  if (!el) return '';
  if (el.type === 'hidden') return el.value || '';
  if (el.type === 'checkbox') return el.checked ? 'yes' : '';
  return el.value || '';
}

function collectAllData() {
  const data = {};
  // Text/number/email/tel/select/textarea
  document.querySelectorAll('input[type="text"], input[type="email"], input[type="number"], input[type="tel"], input[type="hidden"], select, textarea').forEach(el => {
    if (el.id && el.id !== '') data[el.id] = el.value;
    else if (el.name && el.name !== '') data[el.name] = el.value;
  });
  // Checkboxes
  document.querySelectorAll('input[type="checkbox"]').forEach(el => {
    if (el.id) data[el.id] = el.checked;
  });
  data._section = currentSection;
  data._country = document.getElementById('bizCountry')?.value || '';
  return data;
}

function saveState() {
  const data = collectAllData();
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  } catch(e) {}
  updateCompletionBadges();
  showAutosaveBar();
  document.getElementById('share-btn').classList.add('visible');
}

function loadState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return null;
    return JSON.parse(raw);
  } catch(e) { return null; }
}

function showAutosaveBar() {
  const bar = document.getElementById('autosave-bar');
  bar.classList.add('show');
  clearTimeout(autosaveTimer);
  autosaveTimer = setTimeout(() => bar.classList.remove('show'), 2500);
}

function checkHashRestore() {
  const hash = window.location.hash;
  if (!hash || hash.length < 2) return null;
  try {
    const b64 = hash.slice(1);
    const json = atob(b64);
    return JSON.parse(json);
  } catch(e) { return null; }
}

function restoreData(data) {
  if (!data) return;
  Object.keys(data).forEach(key => {
    if (key === '_section') return;
    const el = document.getElementById(key);
    if (!el) return;
    if (el.type === 'checkbox') {
      el.checked = !!data[key];
    } else if (el.type === 'hidden') {
      // radio hidden input — restore visual selection
      el.value = data[key];
      if (data[key]) {
        const group = document.getElementById('rg-' + el.name);
        if (group) {
          // find label with matching onclick value
          const opts = group.querySelectorAll('.radio-opt');
          opts.forEach(opt => {
            const onclick = opt.getAttribute('onclick') || '';
            if (onclick.includes("'" + data[key] + "'")) {
              opt.classList.add('selected');
            }
          });
        }
      }
    } else {
      el.value = data[key];
    }
  });
  // restore country/currency after all fields are set
  const country = data._country || document.getElementById('bizCountry')?.value;
  if (country) {
    const countryEl = document.getElementById('bizCountry');
    if (countryEl) countryEl.value = country;
    onCountryChange();
    // restore state after onCountryChange repopulates the dropdown
    if (data.bizState) {
      const stateEl = document.getElementById('bizState');
      if (stateEl) stateEl.value = data.bizState;
    }
  }
  updateYoY();
  updateCalc();
  updateCompletionBadges();
}


// ============================================================
// NAVIGATION
// ============================================================
function startAssessment() {
  document.getElementById('welcome').style.display = 'none';
  document.getElementById('progress-wrap').classList.add('show');
  document.getElementById('share-btn').classList.add('visible');
  buildPills();
  goToSection(1);
}

function resumeSaved(e) {
  if (e) e.preventDefault();
  const data = loadState();
  if (!data) { startAssessment(); return; }
  restoreData(data);
  document.getElementById('welcome').style.display = 'none';
  document.getElementById('progress-wrap').classList.add('show');
  document.getElementById('share-btn').classList.add('visible');
  buildPills();
  const sec = parseInt(data._section) || 1;
  goToSection(sec);
}

function buildPills() {
  const container = document.getElementById('progress-pills');
  container.innerHTML = '';
  SECTIONS.forEach((s, i) => {
    const pill = document.createElement('div');
    pill.className = 'pill';
    pill.id = 'pill-' + (i + 1);
    pill.onclick = () => goToSection(i + 1);
    pill.innerHTML = `<span>${i + 1}. ${s.short}</span><span class="pill-pct" id="pill-pct-${i+1}">0%</span>`;
    container.appendChild(pill);
  });
  updateCompletionBadges();
}

function goToSection(n) {
  // Hide all sections and results
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById('results').style.display = 'none';

  if (n > 13) {
    // Show results
    document.getElementById('results').style.display = 'block';
    document.getElementById('results').classList.add('active');
    renderResults();
    updatePills(null);
    window.scrollTo({ top: 0, behavior: 'smooth' });
    return;
  }

  const sectionEl = document.getElementById('s' + n);
  if (!sectionEl) return;
  sectionEl.classList.add('active');
  // Trigger animation by re-triggering fade-slide-in
  sectionEl.querySelectorAll('.fade-slide-in').forEach(el => {
    el.style.animation = 'none';
    el.offsetHeight; // reflow
    el.style.animation = '';
  });

  currentSection = n;
  updatePills(n);
  saveState();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function updatePills(active) {
  SECTIONS.forEach((s, i) => {
    const pill = document.getElementById('pill-' + (i + 1));
    if (!pill) return;
    pill.classList.remove('active', 'done');
    if (active === i + 1) {
      pill.classList.add('active');
    } else if (active !== null && i + 1 < active) {
      pill.classList.add('done');
    }
  });
}

function updateCompletionBadges() {
  SECTIONS.forEach((s, i) => {
    const n = i + 1;
    const fields = SECTION_TRACKED[s.id] || [];
    if (!fields.length) return;
    let filled = 0;
    fields.forEach(f => {
      const val = getFieldValue(f);
      if (val && val !== '') filled++;
    });
    const pct = Math.round((filled / fields.length) * 100);
    const pctEl = document.getElementById('pill-pct-' + n);
    if (pctEl) pctEl.textContent = pct + '%';
  });
}

// ============================================================
// FORM HELPERS
// ============================================================
function selectRadio(name, value, labelEl) {
  // Deselect all in group
  const group = document.getElementById('rg-' + name);
  if (group) {
    group.querySelectorAll('.radio-opt').forEach(opt => opt.classList.remove('selected'));
  }
  // Select this
  if (labelEl) labelEl.classList.add('selected');
  // Set hidden input
  const hidden = document.getElementById(name);
  if (hidden) hidden.value = value;
  // Clear error if any
  const card = document.getElementById('card-' + name);
  if (card) card.classList.remove('has-error');
  saveState();
  updateCalc();
}

function toggleCheck(id, labelEl) {
  const cb = document.getElementById(id);
  if (cb) cb.checked = !cb.checked;
  if (labelEl) labelEl.classList.toggle('selected', cb && cb.checked);
  saveState();
}

function autoMapSector() {
  const industry = document.getElementById('industry').value;
  const d1 = document.getElementById('D1');
  if (!d1) return;
  if (industry && INDUSTRY_TO_SECTOR[industry]) {
    d1.value = INDUSTRY_TO_SECTOR[industry];
    updateCalc();
  }
}

// ============================================================
// VALIDATION
// ============================================================
function validateSection(n) {
  const errors = [];
  if (n === 1) {
    if (!getFieldValue('bizCountry')) errors.push({ cardId: 'card-s1-location', msg: 'Please select your country.' });
    if (getFieldValue('bizCountry') && !getFieldValue('bizState')) errors.push({ cardId: 'card-s1-location', msg: 'Please select your state / province / county.' });
    if (!getFieldValue('legalName').trim()) errors.push({ cardId: 'card-s1-basic', msg: 'Legal Business Name is required.' });
    if (!getFieldValue('industry')) errors.push({ cardId: 'card-s1-basic', msg: 'Please select your industry.' });
    if (!getFieldValue('headcount')) errors.push({ cardId: 'card-s1-basic', msg: 'Please select number of employees.' });
    if (!getFieldValue('yearFounded')) errors.push({ cardId: 'card-s1-basic', msg: 'Year Founded is required.' });
    if (!getFieldValue('contactName').trim()) errors.push({ cardId: 'card-s1-contact', msg: 'Contact Name is required.' });
    if (!getFieldValue('contactEmail').trim()) errors.push({ cardId: 'card-s1-contact', msg: 'Contact Email is required.' });
    else {
      const emailEl = document.getElementById('contactEmail');
      if (!emailEl.checkValidity()) errors.push({ cardId: 'card-s1-contact', msg: 'Please enter a valid email address.' });
    }
    const privacy = document.getElementById('privacyCheck');
    if (!privacy || !privacy.checked) errors.push({ cardId: 'card-s1-contact', msg: 'Please accept the Privacy Policy to continue.' });
  }
  if (n === 2) {
    const b1 = parseFloat(getFieldValue('B1'));
    const b2 = parseFloat(getFieldValue('B2'));
    if (!getFieldValue('B1') || isNaN(b1) || b1 < 0) errors.push({ cardId: 'card-s2-rev', msg: 'Revenue (current year) is required and must be a positive number.' });
    if (getFieldValue('B1') && b1 === 0) errors.push({ cardId: 'card-s2-rev', msg: 'Revenue cannot be zero.' });
    if (!getFieldValue('B2') || isNaN(b2)) errors.push({ cardId: 'card-s2-rev', msg: 'EBITDA (current year) is required.' });
    if (!isNaN(b2) && !isNaN(b1) && b2 > b1) errors.push({ cardId: 'card-s2-rev', msg: 'EBITDA cannot exceed Revenue. Please check your figures.' });
    const radios = ['B3','B4','B5','B6','B7','B8','B9','B10','B11','BGPM'];
    radios.forEach(r => {
      if (!getFieldValue(r)) errors.push({ cardId: 'card-' + r, msg: 'Please select an answer for question ' + r + '.' });
    });
  }
  if (n === 3) {
    if (!getFieldValue('D1')) errors.push({ cardId: 'card-D1', msg: 'Please select a sector multiple.' });
    const d2b = parseFloat(getFieldValue('D2b'));
    if (!getFieldValue('D2b') || isNaN(d2b)) errors.push({ cardId: 'card-D1', msg: 'Normalised EBITDA is required.' });
    if (!isNaN(d2b) && d2b < 0) errors.push({ cardId: 'card-D1', msg: 'Normalised EBITDA cannot be negative.' });
    ['D4','D5','D6'].forEach(r => {
      if (!getFieldValue(r)) errors.push({ cardId: 'card-' + r, msg: 'Please select an answer for question ' + r + '.' });
    });
  }
  if (n === 4) {
    ['G1','G2','G3','G4','G5'].forEach(r => {
      if (!getFieldValue(r)) errors.push({ cardId: 'card-' + r, msg: 'Please answer question ' + r + '.' });
    });
  }
  if (n === 5) {
    ['C1','C2','C3','C4','C5'].forEach(r => {
      if (!getFieldValue(r)) errors.push({ cardId: 'card-' + r, msg: 'Please answer question ' + r + '.' });
    });
  }
  if (n === 6) {
    ['O1','O2','O3','O4'].forEach(r => {
      if (!getFieldValue(r)) errors.push({ cardId: 'card-' + r, msg: 'Please answer question ' + r + '.' });
    });
  }
  if (n === 7) {
    ['T1','T2','T3','T4'].forEach(r => {
      if (!getFieldValue(r)) errors.push({ cardId: 'card-' + r, msg: 'Please answer question ' + r + '.' });
    });
  }
  if (n === 8) {
    ['R1','R2','R3','R4'].forEach(r => {
      if (!getFieldValue(r)) errors.push({ cardId: 'card-' + r, msg: 'Please answer question ' + r + '.' });
    });
  }
  if (n === 9) {
    ['I1','I2','I3'].forEach(r => {
      if (!getFieldValue(r)) errors.push({ cardId: 'card-' + r, msg: 'Please answer question ' + r + '.' });
    });
  }
  if (n === 10) {
    ['BR1','BR2','BR3'].forEach(r => {
      if (!getFieldValue(r)) errors.push({ cardId: 'card-' + r, msg: 'Please answer question ' + r + '.' });
    });
  }
  if (n === 11) {
    ['S1','S2','S3'].forEach(r => {
      if (!getFieldValue(r)) errors.push({ cardId: 'card-' + r, msg: 'Please answer question ' + r + '.' });
    });
  }
  if (n === 12) {
    ['E1','E2','E3','E4'].forEach(r => {
      if (!getFieldValue(r)) errors.push({ cardId: 'card-' + r, msg: 'Please answer question ' + r + '.' });
    });
  }
  if (n === 13) {
    ['CA1','CA2','CA3'].forEach(r => {
      if (!getFieldValue(r)) errors.push({ cardId: 'card-' + r, msg: 'Please answer question ' + r + '.' });
    });
  }
  return errors;
}

function showErrors(errors, sectionId) {
  // Clear previous
  clearErrors(sectionId);
  if (!errors.length) return;
  // Highlight cards
  errors.forEach(e => {
    const card = document.getElementById(e.cardId);
    if (card) card.classList.add('has-error');
  });
  // Show banner
  const banner = document.getElementById('err-' + sectionId);
  if (banner) {
    banner.classList.add('show');
    const msgs = [...new Set(errors.map(e => e.msg))];
    banner.innerHTML = '<strong>Please fix the following before continuing:</strong><ul>' +
      msgs.map(m => '<li>' + m + '</li>').join('') + '</ul>';
    banner.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }
}

function clearErrors(sectionId) {
  const banner = document.getElementById('err-' + sectionId);
  if (banner) { banner.classList.remove('show'); banner.innerHTML = ''; }
  const sec = document.getElementById(sectionId);
  if (sec) sec.querySelectorAll('.has-error').forEach(el => el.classList.remove('has-error'));
}

function validateAndGo(targetN) {
  const fromN = currentSection;
  const errors = validateSection(fromN);
  if (errors.length) {
    showErrors(errors, 's' + fromN);
    return;
  }
  clearErrors('s' + fromN);
  goToSection(targetN);
}


// ============================================================
// CALCULATOR
// ============================================================
function getMultipleRange(val) {
  return SECTOR_MULTIPLES[val] || null;
}

function getAdjustedMultiple(sectorVal, qualityScore) {
  // qualityScore is 0-3; map to position within range
  const range = getMultipleRange(sectorVal);
  if (!range) return null;
  const [low, high] = range;
  // Map 0→low, 3→high using quality score
  const position = qualityScore / 3;
  return low + (high - low) * position;
}

function calcCurrentQualityScore() {
  // Use available scored questions to estimate quality for live calc
  const scores = calcAllScores();
  return calcOverallScore(scores);
}

function updateCalc() {
  const d1Val = getFieldValue('D1');
  let ebitda = parseFloat(getFieldValue('D2b'));
  if (isNaN(ebitda) || !getFieldValue('D2b')) {
    // Fall back to B2
    ebitda = parseFloat(getFieldValue('B2'));
  }

  const ebitdaEl = document.getElementById('calc-ebitda');
  const rangeEl = document.getElementById('calc-range');
  const qualityEl = document.getElementById('calc-quality');
  const multipleEl = document.getElementById('calc-multiple');
  const totalEl = document.getElementById('calc-total');
  const rangeDisplayEl = document.getElementById('calc-range-display');
  const qualityPctEl = document.getElementById('calc-quality-pct');
  const barFill = document.getElementById('quality-bar-fill');

  if (!ebitdaEl) return;

  const qualityScore = calcCurrentQualityScore();
  const qualPct = scorePct(qualityScore);

  if (qualityPctEl) qualityPctEl.textContent = qualPct + '%';
  if (barFill) barFill.style.width = qualPct + '%';
  if (qualityEl) qualityEl.textContent = qualPct + '% (' + scoreLabel(qualityScore)[1] + ')';

  if (isNaN(ebitda)) {
    ebitdaEl.textContent = '—';
    rangeEl.textContent = '—';
    multipleEl.textContent = '—';
    totalEl.textContent = '—';
    if (rangeDisplayEl) rangeDisplayEl.textContent = 'Enter EBITDA & select sector to calculate';
    return;
  }

  ebitdaEl.textContent = selectedCurrency.symbol + formatNum(ebitda);

  const range = getMultipleRange(d1Val);
  if (!range) {
    rangeEl.textContent = '—';
    multipleEl.textContent = '—';
    totalEl.textContent = '—';
    if (rangeDisplayEl) rangeDisplayEl.textContent = 'Select sector to see range';
    return;
  }

  const [low, high] = range;
  rangeEl.textContent = low.toFixed(1) + 'x – ' + high.toFixed(1) + 'x';

  const adjMultiple = getAdjustedMultiple(d1Val, qualityScore);
  multipleEl.textContent = adjMultiple.toFixed(2) + 'x';

  const midVal = ebitda * adjMultiple;
  const lowVal = ebitda * low;
  const highVal = ebitda * high;

  totalEl.textContent = selectedCurrency.symbol + formatNum(Math.round(midVal));
  if (rangeDisplayEl) {
    const sym = selectedCurrency.symbol;
    rangeDisplayEl.textContent = 'Range: ' + sym + formatNum(Math.round(lowVal)) + ' – ' + sym + formatNum(Math.round(highVal));
  }
}

function updateYoY() {
  const b1 = parseFloat(document.getElementById('B1').value);
  const b1p = parseFloat(document.getElementById('B1_prev').value);
  const b2 = parseFloat(document.getElementById('B2').value);
  const b2p = parseFloat(document.getElementById('B2_prev').value);

  const display = document.getElementById('yoy-display');
  if (!display) return;

  const items = [];
  if (!isNaN(b1) && !isNaN(b1p) && b1p !== 0) {
    const revGrowth = ((b1 - b1p) / Math.abs(b1p)) * 100;
    const cls = revGrowth >= 0 ? 'yoy-pos' : 'yoy-neg';
    const sign = revGrowth >= 0 ? '+' : '';
    items.push(`<div class="yoy-item">Revenue YoY: <span class="${cls}">${sign}${revGrowth.toFixed(1)}%</span></div>`);
  }
  if (!isNaN(b2) && !isNaN(b2p) && b2p !== 0) {
    const ebitdaGrowth = ((b2 - b2p) / Math.abs(b2p)) * 100;
    const cls = ebitdaGrowth >= 0 ? 'yoy-pos' : 'yoy-neg';
    const sign = ebitdaGrowth >= 0 ? '+' : '';
    items.push(`<div class="yoy-item">EBITDA YoY: <span class="${cls}">${sign}${ebitdaGrowth.toFixed(1)}%</span></div>`);
  }
  if (!isNaN(b1) && b1 > 0 && !isNaN(b2)) {
    const margin = (b2 / b1) * 100;
    const cls = margin >= 15 ? 'yoy-pos' : margin >= 5 ? 'yoy-neu' : 'yoy-neg';
    items.push(`<div class="yoy-item">EBITDA Margin: <span class="${cls}">${margin.toFixed(1)}%</span></div>`);
  }

  if (items.length) {
    display.className = 'yoy-display show';
    display.innerHTML = items.join('');
  } else {
    display.className = 'yoy-display';
    display.innerHTML = '';
  }
}

// ============================================================
// SCORING
// ============================================================
function scoreQ(name) {
  const val = getFieldValue(name);
  if (!val) return null;
  const map = SCORE_MAPS[name];
  if (!map) return null;
  const score = map[val];
  return (score !== undefined) ? score : null;
}

function scoreCategory(catName) {
  const cat = SCORE_CATEGORIES[catName];
  if (!cat) return null;
  let total = 0, count = 0;
  cat.questions.forEach(q => {
    const s = scoreQ(q);
    if (s !== null) { total += s; count++; }
  });
  if (count === 0) return null;
  return total / count; // 0-3 scale
}

function calcAllScores() {
  const scores = {};
  Object.keys(SCORE_CATEGORIES).forEach(cat => {
    scores[cat] = scoreCategory(cat);
  });
  return scores;
}

function calcOverallScore(scores) {
  let weightedTotal = 0, weightSum = 0;
  Object.keys(SCORE_CATEGORIES).forEach(cat => {
    const s = scores[cat];
    if (s !== null && s !== undefined) {
      const w = SCORE_CATEGORIES[cat].weight;
      weightedTotal += s * w;
      weightSum += w;
    }
  });
  if (weightSum === 0) return 0;
  return weightedTotal / weightSum; // 0-3 scale
}

function scoreLabel(n) {
  if (n >= 2.5) return ['score-excellent', 'Excellent'];
  if (n >= 1.75) return ['score-good', 'Good'];
  if (n >= 1.0)  return ['score-fair', 'Fair'];
  return ['score-poor', 'Needs Work'];
}

function scorePct(n) {
  return Math.round((n / 3) * 100);
}

function scoreFillColor(n) {
  const pct = scorePct(n);
  if (pct >= 80) return '#28a745';
  if (pct >= 55) return '#17a2b8';
  if (pct >= 33) return '#ffc107';
  return '#dc3545';
}

// ============================================================
// SHARE / RESUME
// ============================================================
function getShareLink() {
  const data = collectAllData();
  try {
    const json = JSON.stringify(data);
    const b64 = btoa(unescape(encodeURIComponent(json)));
    return window.location.origin + window.location.pathname + '#' + b64;
  } catch(e) { return window.location.href; }
}

function copyShareLink() {
  const link = getShareLink();
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(link).then(() => {
      const btn = document.getElementById('share-btn');
      const orig = btn.innerHTML;
      btn.innerHTML = '&#10003; Link Copied!';
      setTimeout(() => { btn.innerHTML = orig; }, 2500);
    });
  } else {
    // Fallback
    const ta = document.createElement('textarea');
    ta.value = link;
    ta.style.position = 'fixed';
    ta.style.opacity = '0';
    document.body.appendChild(ta);
    ta.focus(); ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    const btn = document.getElementById('share-btn');
    const orig = btn.innerHTML;
    btn.innerHTML = '&#10003; Link Copied!';
    setTimeout(() => { btn.innerHTML = orig; }, 2500);
  }
}

// ============================================================
// FORMATTING HELPERS
// ============================================================
function formatNum(n) {
  if (isNaN(n) || n === null || n === undefined) return '—';
  return n.toLocaleString(selectedCurrency.locale);
}

function fmtCurrency(n) {
  if (isNaN(n) || n === null) return '—';
  return selectedCurrency.symbol + Math.round(n).toLocaleString(selectedCurrency.locale);
}


// ============================================================
// RESULTS RENDERING
// ============================================================
function renderResults() {
  const scores = calcAllScores();
  const overall = calcOverallScore(scores);
  const overallPct = scorePct(overall);
  const [overallClass, overallLbl] = scoreLabel(overall);

  // --- Financial figures ---
  const b1 = parseFloat(getFieldValue('B1')) || 0;
  const b1p = parseFloat(getFieldValue('B1_prev')) || 0;
  const b2 = parseFloat(getFieldValue('B2')) || 0;
  const b2p = parseFloat(getFieldValue('B2_prev')) || 0;
  let normEbitda = parseFloat(getFieldValue('D2b'));
  if (isNaN(normEbitda) || !getFieldValue('D2b')) normEbitda = b2;
  const d1Val = getFieldValue('D1');
  const range = getMultipleRange(d1Val);
  const adjMultiple = range ? getAdjustedMultiple(d1Val, overall) : null;

  const lowVal  = range && !isNaN(normEbitda) ? normEbitda * range[0]  : null;
  const highVal = range && !isNaN(normEbitda) ? normEbitda * range[1]  : null;
  const midVal  = adjMultiple && !isNaN(normEbitda) ? normEbitda * adjMultiple : null;

  // --- Hero ---
  const heroRange = document.getElementById('res-value-range');
  if (lowVal && highVal) {
    heroRange.innerHTML = fmtCurrency(lowVal) + ' – ' + fmtCurrency(highVal);
  } else {
    heroRange.textContent = 'Insufficient data';
  }

  const resMeta = document.getElementById('res-meta');
  const bizName = getFieldValue('legalName') || 'Your Business';
  resMeta.textContent = bizName + ' | Quality-adjusted multiple: ' +
    (adjMultiple ? adjMultiple.toFixed(2) + 'x' : 'N/A') +
    ' | Sector: ' + (d1Val || 'N/A');

  // Quality score hero
  document.getElementById('res-quality-score').textContent = overallPct + '%';
  document.getElementById('res-quality-label').textContent = overallLbl;
  document.getElementById('res-quality-label').className = overallClass;
  const qBar = document.getElementById('res-quality-bar');
  if (qBar) {
    setTimeout(() => { qBar.style.width = overallPct + '%'; }, 200);
  }

  // --- Financial Summary ---
  const revYoY = (b1 && b1p) ? ((b1 - b1p) / Math.abs(b1p) * 100) : null;
  const ebitdaYoY = (b2 && b2p) ? ((b2 - b2p) / Math.abs(b2p) * 100) : null;
  const margin = b1 ? (b2 / b1 * 100) : null;
  const normMargin = b1 && normEbitda ? (normEbitda / b1 * 100) : null;

  let finHTML = '';
  finHTML += finRow('Revenue (Current Year)', fmtCurrency(b1),
    revYoY !== null ? `<span class="fin-yoy ${revYoY >= 0 ? 'pos' : 'neg'}">${revYoY >= 0 ? '+' : ''}${revYoY.toFixed(1)}% YoY</span>` : '');
  if (b1p) finHTML += finRow('Revenue (Prior Year)', fmtCurrency(b1p), '');
  finHTML += finRow('EBITDA (Current Year)', fmtCurrency(b2),
    ebitdaYoY !== null ? `<span class="fin-yoy ${ebitdaYoY >= 0 ? 'pos' : 'neg'}">${ebitdaYoY >= 0 ? '+' : ''}${ebitdaYoY.toFixed(1)}% YoY</span>` : '');
  if (b2p) finHTML += finRow('EBITDA (Prior Year)', fmtCurrency(b2p), '');
  if (margin !== null) finHTML += finRow('EBITDA Margin', margin.toFixed(1) + '%', '');
  finHTML += finRow('Normalised EBITDA', fmtCurrency(normEbitda), '');
  if (normMargin !== null) finHTML += finRow('Normalised EBITDA Margin', normMargin.toFixed(1) + '%', '');

  document.getElementById('res-financials').innerHTML = finHTML;

  // --- Valuation Detail ---
  let valHTML = '';
  valHTML += finRow('Sector', d1Val ? d1Val.toUpperCase() : '—', '');
  if (range) valHTML += finRow('Sector Multiple Range', range[0].toFixed(1) + 'x – ' + range[1].toFixed(1) + 'x', '');
  if (adjMultiple) valHTML += finRow('Quality-Adjusted Multiple', adjMultiple.toFixed(2) + 'x', '');
  valHTML += finRow('Overall Quality Score', overallPct + '% (' + overallLbl + ')', '');
  if (midVal) valHTML += finRow('Central Value Estimate', fmtCurrency(midVal), '');
  if (lowVal && highVal) valHTML += finRow('Indicative Range', fmtCurrency(lowVal) + ' – ' + fmtCurrency(highVal), '');
  document.getElementById('res-valuation-detail').innerHTML = valHTML;

  // --- Scorecard ---
  const catLabels = {
    financials: 'Financials',
    customers:  'Customers',
    team:       'Team',
    growth:     'Growth',
    risk:       'Risk Profile',
    innovation: 'Innovation',
    brand:      'Brand',
    strategy:   'Strategy',
    exit:       'Exit Readiness',
    capacity:   'Capacity',
  };

  let scoreHTML = '';
  Object.keys(SCORE_CATEGORIES).forEach(cat => {
    const s = scores[cat];
    if (s === null || s === undefined) return;
    const pct = scorePct(s);
    const [cls, lbl] = scoreLabel(s);
    const color = scoreFillColor(s);
    const w = SCORE_CATEGORIES[cat].weight;
    scoreHTML += `
      <div class="score-row">
        <div class="score-cat">${catLabels[cat]}</div>
        <div class="score-mini-bar"><div class="score-mini-fill" style="width:${pct}%;background:${color}"></div></div>
        <div class="score-val">${pct}%</div>
        <div class="score-badge ${cls}">${lbl}</div>
      </div>`;
  });

  // Weighted total row
  scoreHTML += `
    <div class="score-row" style="border-top:2px solid #dee2e6;margin-top:6px;padding-top:10px;">
      <div class="score-cat" style="font-weight:800;color:#1a3a5c;">OVERALL SCORE</div>
      <div class="score-mini-bar"><div class="score-mini-fill" style="width:${overallPct}%;background:${scoreFillColor(overall)}"></div></div>
      <div class="score-val" style="font-weight:800;font-size:14px;">${overallPct}%</div>
      <div class="score-badge ${overallClass}" style="font-size:11px;">${overallLbl}</div>
    </div>`;

  document.getElementById('res-scorecard').innerHTML = scoreHTML;

  // Trigger animation on score bars
  setTimeout(() => {
    document.querySelectorAll('.score-mini-fill').forEach(bar => {
      const w = bar.style.width;
      bar.style.width = '0';
      setTimeout(() => { bar.style.width = w; }, 50);
    });
  }, 100);

  // --- Observations ---
  const obs = generateObservations(scores, overall, b1, b1p, b2, b2p, normEbitda, adjMultiple, range);
  const obsList = document.getElementById('res-observations');
  obsList.innerHTML = obs.map(o =>
    `<div class="obs-item ${o.type}"><div class="obs-icon">${o.icon}</div><div>${o.text}</div></div>`
  ).join('');

  // Pre-fill advisor form
  document.getElementById('adv-biz-name').value = getFieldValue('legalName') || '';
  document.getElementById('adv-val-range').value = (lowVal && highVal) ?
    fmtCurrency(lowVal) + ' – ' + fmtCurrency(highVal) : '';
  document.getElementById('adv-qual-score').value = overallPct + '% (' + overallLbl + ')';

  // Pre-fill advisor contact from section 1
  const advName = document.getElementById('adv-name');
  const advEmail = document.getElementById('adv-email');
  if (advName && !advName.value) advName.value = getFieldValue('contactName') || '';
  if (advEmail && !advEmail.value) advEmail.value = getFieldValue('contactEmail') || '';
}

function finRow(label, value, extra) {
  return `<div class="fin-row"><span>${label}</span><span><strong>${value}</strong> ${extra || ''}</span></div>`;
}

function generateObservations(scores, overall, b1, b1p, b2, b2p, normEbitda, adjMultiple, range) {
  const obs = [];

  // Revenue trend
  if (b1 && b1p) {
    const revGrowth = (b1 - b1p) / Math.abs(b1p) * 100;
    if (revGrowth >= 15) {
      obs.push({ type: 'positive', icon: '&#128200;', text: `Strong revenue growth of ${revGrowth.toFixed(1)}% year-on-year demonstrates the business is on a positive trajectory, which buyers will view favourably.` });
    } else if (revGrowth >= 5) {
      obs.push({ type: 'info', icon: '&#128200;', text: `Steady revenue growth of ${revGrowth.toFixed(1)}% YoY is solid. Demonstrating continued momentum in future periods will strengthen valuation.` });
    } else if (revGrowth < 0) {
      obs.push({ type: 'warning', icon: '&#9660;', text: `Revenue declined ${Math.abs(revGrowth).toFixed(1)}% year-on-year. Buyers will likely discount the multiple or apply more conservative EBITDA if the decline cannot be explained.` });
    }
  }

  // EBITDA margin
  if (b1) {
    const margin = (normEbitda / b1) * 100;
    if (margin >= 20) {
      obs.push({ type: 'positive', icon: '&#128176;', text: `EBITDA margin of ${margin.toFixed(1)}% is strong and above average for most SME sectors. High margins typically attract premium multiples.` });
    } else if (margin < 5) {
      obs.push({ type: 'warning', icon: '&#128176;', text: `EBITDA margin of ${margin.toFixed(1)}% is low. Improving operational efficiency before a sale process will have a significant positive impact on valuation.` });
    }
  }

  // Financials score
  if (scores.financials !== null) {
    const pct = scorePct(scores.financials);
    if (pct >= 75) {
      obs.push({ type: 'positive', icon: '&#127942;', text: 'Strong financial scorecard. Recurring revenue, good margins and clean books are key value drivers that buyers and lenders reward.' });
    } else if (pct < 40) {
      obs.push({ type: 'warning', icon: '&#128269;', text: 'Financial quality score is below average. Focus on improving revenue predictability, reducing debtor days and strengthening financial records.' });
    }
  }

  // Customer score
  if (scores.customers !== null) {
    const pct = scorePct(scores.customers);
    if (pct >= 75) {
      obs.push({ type: 'positive', icon: '&#128101;', text: 'Excellent customer base quality. Long-tenured, diversified, and contracted customers significantly reduce buyer risk and support premium valuations.' });
    } else if (pct < 40) {
      obs.push({ type: 'warning', icon: '&#128101;', text: 'Customer base presents concentration or longevity risk. Formalising contracts and diversifying the customer base before a sale will improve value.' });
    }
  }

  // Team score
  if (scores.team !== null) {
    const pct = scorePct(scores.team);
    if (pct >= 75) {
      obs.push({ type: 'positive', icon: '&#128104;&#8205;&#128187;', text: 'Strong management team reduces owner dependency — one of the most important value drivers. Buyers pay significantly more for businesses that do not rely on the seller.' });
    } else if (pct < 40) {
      obs.push({ type: 'warning', icon: '&#128104;&#8205;&#128187;', text: 'High owner dependency is a significant valuation risk. Investing in a second tier of leadership over 12–24 months before exit can add 0.5–1.5x to your multiple.' });
    }
  }

  // Growth score
  if (scores.growth !== null) {
    const pct = scorePct(scores.growth);
    if (pct >= 75) {
      obs.push({ type: 'positive', icon: '&#127807;', text: 'Strong growth credentials including pipeline, competitive moat and market opportunity. Buyers are often willing to pay a growth premium for businesses with clear upside.' });
    } else if (pct < 40) {
      obs.push({ type: 'info', icon: '&#127807;', text: 'Building a stronger sales pipeline and identifying new market opportunities before approaching buyers can significantly improve your negotiating position.' });
    }
  }

  // Risk score
  if (scores.risk !== null) {
    const pct = scorePct(scores.risk);
    if (pct >= 75) {
      obs.push({ type: 'positive', icon: '&#9989;', text: 'Low risk profile. Adequate insurance, clean legal history and regulatory compliance reduce buyer uncertainty and support full multiple realisation.' });
    } else if (pct < 40) {
      obs.push({ type: 'warning', icon: '&#9888;', text: 'Elevated risk factors identified. Addressing insurance gaps, resolving any legal matters and ensuring compliance will be essential before any sale process.' });
    }
  }

  // Innovation score
  if (scores.innovation !== null) {
    const pct = scorePct(scores.innovation);
    if (pct >= 70) {
      obs.push({ type: 'positive', icon: '&#128161;', text: 'Strong innovation culture and proprietary IP are value-enhancing. Technology-forward businesses typically command premium multiples in the current market.' });
    } else if (pct < 35) {
      obs.push({ type: 'info', icon: '&#128161;', text: 'Consider investing in technology and documenting any proprietary processes or IP. Even basic digitalisation can meaningfully improve buyer appeal.' });
    }
  }

  // Operations score
  if (scores.risk !== null) {
    const oScore = scores.risk; // operations is scored separately
  }

  // Exit readiness
  if (scores.exit !== null) {
    const pct = scorePct(scores.exit);
    if (pct >= 75) {
      obs.push({ type: 'positive', icon: '&#128274;', text: 'Good exit readiness. Having a data room prepared and a clear succession pathway reduces deal risk and typically leads to faster, smoother sale processes.' });
    } else if (pct < 40) {
      obs.push({ type: 'info', icon: '&#128274;', text: 'Early exit planning pays dividends. Businesses that have prepared for at least 12–24 months before a sale consistently achieve better outcomes than those that sell reactively.' });
    }
  }

  // Multiple context
  if (adjMultiple && range) {
    const midpoint = (range[0] + range[1]) / 2;
    if (adjMultiple > midpoint) {
      obs.push({ type: 'positive', icon: '&#128200;', text: `Your quality score positions you at ${adjMultiple.toFixed(2)}x — above the sector midpoint of ${midpoint.toFixed(2)}x. This reflects above-average business quality within your sector.` });
    } else {
      obs.push({ type: 'info', icon: '&#128200;', text: `Your quality score positions you at ${adjMultiple.toFixed(2)}x — below the sector midpoint of ${midpoint.toFixed(2)}x. Targeted improvements in the weakest scoring categories could meaningfully increase this multiple.` });
    }
  }

  // Strategy
  if (scores.strategy !== null) {
    const pct = scorePct(scores.strategy);
    if (pct >= 70) {
      obs.push({ type: 'positive', icon: '&#127919;', text: 'Strong strategic planning and governance foundations. Buyers value businesses where future growth is not dependent on the seller\'s personal vision and relationships.' });
    }
  }

  // Capacity
  if (scores.capacity !== null) {
    const pct = scorePct(scores.capacity);
    if (pct >= 70) {
      obs.push({ type: 'positive', icon: '&#128640;', text: 'Good operational headroom and capital access. The ability to absorb growth without major reinvestment is an attractive feature for acquirers.' });
    } else if (pct < 35) {
      obs.push({ type: 'warning', icon: '&#128640;', text: 'Operational or capital constraints may limit buyer appetite for growth scenarios. Addressing capacity bottlenecks where possible will broaden your buyer pool.' });
    }
  }

  // Always add a general advice observation
  obs.push({ type: 'info', icon: '&#128203;', text: 'This indicative valuation is based on your self-assessment responses. Engage an accredited business valuator or M&A advisor for a formal opinion of value, particularly if you are planning a sale within 3 years.' });

  return obs;
}

// ============================================================
// ADVISOR FORM SUBMISSION
// ============================================================
async function submitAdvisorForm(e) {
  e.preventDefault();
  const form = e.target;
  const data = new FormData(form);

  try {
    const response = await fetch('/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams(data).toString(),
    });

    if (response.ok || response.status === 200 || response.status === 303) {
      document.getElementById('advisor-success').classList.add('show');
      form.style.display = 'none';
    } else {
      alert('Submission failed. Please try again or contact us directly.');
    }
  } catch(err) {
    // Fallback for local dev / offline
    document.getElementById('advisor-success').classList.add('show');
    form.style.display = 'none';
  }
}

// ============================================================
// INIT
// ============================================================
function init() {
  // Check URL hash for share link restore
  const hashData = checkHashRestore();
  if (hashData) {
    restoreData(hashData);
    document.getElementById('welcome').style.display = 'none';
    document.getElementById('progress-wrap').classList.add('show');
    document.getElementById('share-btn').classList.add('visible');
    buildPills();
    const sec = parseInt(hashData._section) || 1;
    goToSection(sec);
    // Clear hash to avoid re-triggering
    history.replaceState(null, '', window.location.pathname);
    return;
  }

  // Check localStorage for saved session
  const saved = loadState();
  if (saved && saved.legalName) {
    const hint = document.getElementById('resume-hint');
    if (hint) hint.classList.add('show');
  }

  // Pre-fill D2a from B2 if they match
  const b2El = document.getElementById('B2');
  const d2aEl = document.getElementById('D2a');
  if (b2El && d2aEl) {
    b2El.addEventListener('input', () => {
      if (!d2aEl.value || d2aEl.value === b2El.value) {
        d2aEl.value = b2El.value;
      }
    });
  }
}

window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
